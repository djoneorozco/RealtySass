<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Tue Feb 10 2026 02:34:24 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="6981385c6b6b422a709ffe47" data-wf-site="697e270fb126ef5fe6610167" lang="en">
<head>
  <meta charset="utf-8">
  <title>Financial Planner Single</title>
  <meta content="Financial Planner Single" property="og:title">
  <meta content="Financial Planner Single" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/realtysass-a30aee.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","PT Serif:400,400italic,700,700italic","Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic","Barlow Condensed:300,400,500,600,700","DM Sans:300,400,500,600,700","Gilda Display:300,400,500,600,700","Inter Tight:300,400,500,600,700"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.svg" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.svg" rel="apple-touch-icon">
</head>
<body>
  <section class="section-261"></section>
  <section class="section-270">
    <div class="code-embed-3 w-embed w-script"><!--  RealtySaSS ‚Ä¢ Affordability Planner (Embed #1) ‚Äî single-file, Webflow-safe  -->
      <style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
  /* ============================================================
    RealtySaSS Theme (clean + lead-gen friendly)
  ============================================================ */
  #va-planner{
    --bg:#0b0e1a;
    --panel:#101426;
    --card:#121936;
    --ink:#e9ecff;
    --muted:#a8b0d6;
    --accent:#6aa7ff;
    --accent2:#8ef3c5;
    --ok:#55d399;
    --warn:#f9c74f;
    --bad:#ff6b6b;
    --stroke:rgba(255,255,255,.08);
    --shadow:0 18px 40px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05);
    --radius:18px;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--ink);
  }
  /* Force sane sizing inside Webflow columns */
  #va-planner *, #va-planner *::before, #va-planner *::after{ box-sizing:border-box; }
  #va-planner .va-wrap{
    width:100%;
    max-width:1344px;
    margin:28px auto;
    padding:0 16px 56px;
    min-width:0;
  }
  #va-planner .va-header{
    display:flex; align-items:flex-start; gap:14px;
    padding:14px 14px 6px;
    border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(16,20,38,.78), rgba(11,14,26,.35));
    border:1px solid var(--stroke);
    box-shadow:var(--shadow);
  }
  #va-planner .va-logo{
    width:52px; height:52px; border-radius:14px;
    display:grid; place-items:center;
    background:radial-gradient(120% 120% at 30% 20%, rgba(142,243,197,.35), rgba(106,167,255,.20));
    border:1px solid rgba(255,255,255,.10);
    font-weight:900;
    letter-spacing:.06em;
  }
  #va-planner .va-h1{ margin:0; font-size:28px; line-height:1.15; letter-spacing:.2px; }
  #va-planner .va-sub{ margin:6px 0 0; color:var(--muted); font-size:14px; max-width:980px; }
  #va-planner .va-kpi{
    display:grid;
    grid-template-columns:repeat(5,minmax(0,1fr));
    gap:12px;
    margin-top:14px;
  }
  @media (max-width:1100px){ #va-planner .va-kpi{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
  @media (max-width:520px){ #va-planner .va-kpi{ grid-template-columns:1fr; } }
  #va-planner .va-kpi .box{
    min-width:0;
    background:linear-gradient(180deg, rgba(18,25,54,.92), rgba(16,20,38,.78));
    border:1px solid var(--stroke);
    border-radius:16px;
    padding:12px 12px 11px;
    box-shadow:0 14px 28px rgba(0,0,0,.35);
  }
  #va-planner .va-kpi .box small{ display:block; color:var(--muted); font-size:11px; letter-spacing:.08em; text-transform:uppercase; }
  #va-planner .va-kpi .box b{ display:block; margin-top:7px; font-size:18px; letter-spacing:.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  #va-planner b.good{color:var(--ok)} #va-planner b.warn{color:var(--warn)} #va-planner b.bad{color:var(--bad)} #va-planner b.neutral{color:var(--ink)}
  #va-planner .va-grid{
    display:grid;
    grid-template-columns:minmax(0,1.12fr) minmax(0,.88fr);
    gap:16px;
    margin-top:16px;
    align-items:start;
    min-width:0;
  }
  @media (max-width:980px){ #va-planner .va-grid{ grid-template-columns:1fr; } }
  #va-planner .va-card{
    min-width:0;
    background:linear-gradient(180deg, rgba(18,25,54,.92), rgba(16,20,38,.78));
    border:1px solid var(--stroke);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px;
  }
  #va-planner .va-card h2{ margin:0 0 10px; font-size:16px; letter-spacing:.3px; }
  #va-planner .va-mt8{margin-top:8px} .va-mt12{margin-top:12px} .va-mt16{margin-top:16px} .va-mt20{margin-top:20px}
  /* Critical fix: use minmax + allow shrink */
  #va-planner .va-row{
    display:grid;
    grid-template-columns:minmax(0,1fr) minmax(0,1fr);
    gap:12px;
    min-width:0;
  }
  @media (max-width:700px){ #va-planner .va-row{ grid-template-columns:1fr; } }
  #va-planner .va-field{ display:flex; flex-direction:column; gap:8px; min-width:0; }
  #va-planner .va-field label{ font-size:12px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
  #va-planner .va-input,
  #va-planner .va-select,
  #va-planner .va-slider,
  #va-planner .va-btn{
    width:100%;
    min-width:0;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(12,14,25,.65);
    color:var(--ink);
    border-radius:12px;
    padding:12px;
    font-size:14px;
    outline:none;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
  }
  #va-planner .va-input:focus,
  #va-planner .va-select:focus{
    border-color:rgba(142,243,197,.45);
    box-shadow:0 0 0 1px rgba(142,243,197,.18), 0 0 24px rgba(142,243,197,.10);
  }
  #va-planner .va-select{ appearance:none; }
  #va-planner .va-btn{
    cursor:pointer;
    border:none;
    background:radial-gradient(120% 120% at 25% 15%, var(--accent2), var(--accent));
    color:#050712;
    font-weight:900;
    letter-spacing:.02em;
  }
  #va-planner .va-btn.secondary{
    background:radial-gradient(120% 120% at 25% 15%, rgba(142,243,197,.92), rgba(125,233,189,.62));
    color:#04120d;
  }
  #va-planner .va-btn.ghost{
    background:rgba(12,14,25,.65);
    border:1px dashed rgba(255,255,255,.18);
    color:var(--ink);
    font-weight:800;
  }
  #va-planner .toggle{ display:flex; align-items:center; gap:10px; margin-top:8px; }
  #va-planner .hidden{ display:none !important; }
  #va-planner .va-note{ color:var(--muted); font-size:12px; line-height:1.4; }
  /* Chart sizing that looks ‚ÄúSaaS‚Äù, not a skinny tower */
  #va-planner .va-legend{ display:flex; gap:12px; flex-wrap:wrap; margin-top:6px; }
  #va-planner .va-tag{ display:inline-flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); }
  #va-planner .va-dot{ width:10px; height:10px; border-radius:50%; }
  #va-planner .chartBox{
    height: clamp(220px, 34vh, 330px);
    width: 100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.06);
    background:rgba(11,14,26,.35);
    padding:10px;
    overflow:hidden;
  }
  #va-planner canvas{ width:100% !important; height:100% !important; display:block; }
  #va-planner .va-status{
    display:flex; align-items:flex-start; gap:10px;
    padding:12px;
    border-radius:14px;
    background:rgba(11,14,26,.55);
    border:1px solid rgba(255,255,255,.08);
    margin-top:14px;
  }
  #va-planner .va-status.ok{ outline:2px solid rgba(85,211,153,.18); }
  #va-planner .va-status.warn{ outline:2px solid rgba(249,199,79,.18); }
  #va-planner .va-status.bad{ outline:2px solid rgba(255,107,107,.18); }
  #va-planner .va-meter{
    height:14px; border-radius:999px; overflow:hidden;
    background:#0b0f23; border:1px solid rgba(255,255,255,.08);
    margin-top:14px;
  }
  /* Budget panel */
  #va-planner .bp-panel{
    margin-top:10px;
    border:1px dashed rgba(255,255,255,.14);
    border-radius:14px;
    padding:12px;
    background:rgba(15,19,38,.75);
  }
  #va-planner .bp-row{
    display:grid;
    grid-template-columns:130px minmax(0,1fr) 160px 90px;
    gap:8px;
    align-items:center;
    min-width:0;
  }
  @media(max-width:720px){ #va-planner .bp-row{ grid-template-columns:1fr; } }
  #va-planner .bp-table{ width:100%; border-collapse:separate; border-spacing:0 8px; margin-top:10px; }
  #va-planner .bp-tr{ background:rgba(12,14,25,.65); border:1px solid rgba(255,255,255,.10); border-radius:12px; }
  #va-planner .bp-td,#va-planner .bp-th{ padding:8px 10px; font-size:13px; }
  #va-planner .bp-controls{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
  #va-planner .bp-chip{
    padding:6px 10px;
    border-radius:999px;
    background:rgba(12,14,25,.65);
    border:1px solid rgba(255,255,255,.12);
    font-size:12px;
    color:var(--muted);
  }
  #va-planner .va-footer{ margin-top:18px; color:var(--muted); font-size:12px; text-align:center; }
</style>
      <div class="va-wrap" id="va-planner">
        <div class="va-header">
          <div class="va-logo">RS</div>
          <div>
            <h1 class="va-h1">Affordability Planner</h1>
            <p class="va-sub">A clean affordability ‚Äúwhat-if‚Äù calculator you can embed on your site to capture better leads. Enter income, expenses, savings, and a home scenario‚Äîpayment updates instantly.</p>
          </div>
        </div>
        <div class="va-kpi" id="kpis">
          <div class="box"><small>Total Monthly Income</small><b id="kpi-income">$0</b></div>
          <div class="box"><small>Total Monthly Expenses</small><b id="kpi-expenses">$0</b></div>
          <div class="box"><small>Housing Estimate</small><b id="kpi-mortgage">$0</b></div>
          <div class="box"><small>Target Savings</small><b id="kpi-savings">$0</b></div>
          <div class="box"><small>Disposable After Housing</small><b id="kpi-disposable" class="neutral">$0</b></div>
        </div>
        <div class="va-grid">
          <!--  LEFT  -->
          <div class="va-card">
            <h2>1) Income</h2>
            <div class="va-row va-mt8">
              <div class="va-field">
                <label>Total Monthly Income ($)</label>
                <input class="va-input" id="in-total" type="number" min="0" step="1" placeholder="e.g., 9000">
                <small class="va-note">Use gross or net‚Äîjust be consistent with your expenses.</small>
              </div>
              <div class="va-field">
                <label>Additional Income ($)</label>
                <input class="va-input" id="in-addl" type="number" min="0" step="1" placeholder="Commission, spouse, side income">
              </div>
            </div>
            <!--  Optional legacy panel (hidden by default for RealtySaSS)  -->
            <div class="toggle hidden">
              <button class="va-btn ghost" id="btn-mil">‚ñº Military Pay (optional)</button>
              <small class="va-note" id="mil-msg">Hidden for non-military Realtor SaaS.</small>
            </div>
            <div id="mil-panel" class="hidden va-mt8"></div>
            <h2 class="va-mt16">2) Expenses</h2>
            <div class="va-row va-mt8">
              <div class="va-field"><label>Core Monthly Expenses ($)</label><input class="va-input" id="ex-core" type="number" min="0" step="1" placeholder="Bills, debt, utilities"></div>
              <div class="va-field"><label>Discretionary Spending ($)</label><input class="va-input" id="ex-disc" type="number" min="0" step="1" placeholder="Dining, travel, subscriptions"></div>
            </div>
            <div class="toggle va-mt8">
              <button class="va-btn ghost" id="btn-bp">‚ñº Itemized Monthly Budget (optional)</button>
              <small class="va-note">Makes the bar chart smarter (and improves conversations with leads).</small>
            </div>
            <div id="bp-panel" class="hidden bp-panel">
              <div class="bp-row">
                <select id="bp-cat" class="va-select">
                  <option>Essentials</option>
                  <option>Discretionary</option>
                  <option>Debt</option>
                  <option>Other</option>
                </select>
                <input id="bp-name" class="va-input" placeholder="Item name (e.g., Rent, Groceries)">
                <input id="bp-month" class="va-input" type="number" min="0" step="1" placeholder="Monthly $">
                <button id="bp-add" class="va-btn">Add</button>
              </div>
              <table class="bp-table">
                <thead>
                  <tr class="bp-tr">
                    <th class="bp-th">Category</th>
                    <th class="bp-th">Item</th>
                    <th class="bp-th">Monthly</th>
                    <th class="bp-th">Annual</th>
                    <th class="bp-th">Del</th>
                  </tr>
                </thead>
                <tbody id="bp-body"></tbody>
              </table>
              <div class="bp-controls">
                <span class="bp-chip">Essentials: <b id="bp-t-Essentials">$0</b></span>
                <span class="bp-chip">Discretionary: <b id="bp-t-Discretionary">$0</b></span>
                <span class="bp-chip">Debt: <b id="bp-t-Debt">$0</b></span>
                <span class="bp-chip">Other: <b id="bp-t-Other">$0</b></span>
                <span class="bp-chip">Total: <b id="bp-t-All">$0</b></span>
                <button id="bp-load" class="va-btn" style="margin-left:auto">Load Example</button>
                <button id="bp-save" class="va-btn secondary">Save & Prefill</button>
              </div>
              <div class="va-note" id="bp-note" style="margin-top:6px">Not saved yet.</div>
            </div>
            <h2 class="va-mt16">3) Savings Target</h2>
            <div class="va-field va-mt8">
              <label>Desired Savings Rate <span id="save-rate-label" style="color:var(--accent2);font-weight:800">15%</span></label>
              <input class="va-slider" id="save-rate" type="range" min="0" max="40" step="1" value="15">
              <small class="va-note">Savings comes before house‚Äîprotect your buffer.</small>
            </div>
            <h2 class="va-mt16">4) Home Scenario (What-If)</h2>
            <div class="va-field va-mt8">
              <label>Credit Score <span id="cs-label">720 ‚Äì Good</span></label>
              <input class="va-slider" id="cs-slider" type="range" min="500" max="850" step="5" value="720">
            </div>
            <div class="va-note">Estimated APR from credit score: <b id="apr-label">7.00%</b> (illustrative).</div>
            <div class="va-row va-mt8">
              <div class="va-field">
                <label>Home Price ($)</label>
                <input class="va-input" id="h-price" type="number" min="0" step="1000" placeholder="e.g., 450000">
              </div>
              <div class="va-field">
                <label>Down Payment % <span id="dp-pct-label">20%</span> = <span id="dp-amt-label">$0</span></label>
                <input class="va-slider" id="dp-slider" type="range" min="0" max="100" step="1" value="20">
              </div>
            </div>
            <div class="va-row va-mt8">
              <div class="va-field"><label>Interest Rate (APR %)</label><input class="va-input" id="h-rate" type="number" step="0.01" value="7.00"></div>
              <div class="va-field"><label>Down Payment ($)</label><input class="va-input" id="dp-amt" type="text" disabled=""></div>
            </div>
            <div class="va-row va-mt8">
              <div class="va-field"><label>Term (years)</label><input class="va-input" id="h-term" type="number" min="5" max="40" step="1" value="30"></div>
              <div class="va-field"><label>Taxes + Insurance + HOA ($/mo)</label><input class="va-input" id="h-tihoa" type="number" min="0" step="1" value="0"></div>
            </div>
            <div class="va-row va-mt8">
              <div class="va-field"><label>PMI ($/mo)</label><input class="va-input" id="h-pmi" type="number" min="0" step="1" value="0"></div>
              <div class="va-field"><label>&nbsp;</label>
                <div class="va-note">APR/PMI are illustrative only; verify with your lender.</div>
              </div>
            </div>
            <div class="va-row va-mt16" style="grid-template-columns:1fr 1fr">
              <button class="va-btn secondary" id="btn-clear">Reset</button>
              <button class="va-btn" id="btn-calc">Update</button>
            </div>
          </div>
          <!--  RIGHT  -->
          <div class="va-card">
            <h2>Visual Budget</h2>
            <div class="va-legend">
              <span class="va-tag"><span class="va-dot" style="background:var(--accent)"></span>Expenses</span>
              <span class="va-tag"><span class="va-dot" style="background:var(--accent2)"></span>Savings</span>
              <span class="va-tag"><span class="va-dot" style="background:var(--warn)"></span>Housing</span>
              <span class="va-tag"><span class="va-dot" style="background:var(--ok)"></span>Disposable</span>
            </div>
            <div class="va-mt12 chartBox"><canvas id="pie"></canvas></div>
            <div class="va-mt12 chartBox" style="height:clamp(220px, 30vh, 300px)"><canvas id="bars"></canvas></div>
            <div class="va-status ok" id="statusBox">
              <div id="statusDot" class="va-dot" style="width:12px;height:12px;background:var(--ok)"></div>
              <div>
                <div id="statusTitle" style="font-weight:900">Healthy Plan</div>
                <div id="statusMsg" class="va-note">You remain cash-flow positive after expenses, savings, and the proposed housing payment.</div>
              </div>
            </div>
            <div class="va-meter">
              <div id="meterFill" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--warn),var(--bad));"></div>
            </div>
            <small class="va-note">Meter shows share of income consumed by Expenses + Savings + Housing. Under 70% comfortable, 70‚Äì85% caution, above 85% risky.</small>
            <div class="va-card va-mt16" style="background:rgba(11,14,26,.45)">
              <h2>Fiduciary Guidance</h2>
              <div id="fiduciaryText" class="va-note">Enter values to see tailored guidance on risks and next steps.</div>
            </div>
          </div>
        </div>
        <div class="va-footer">For education only, not financial advice.</div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
      <script>
(()=>{
  if (window.__RSAP_PLANNER_MOUNTED__) return;
  window.__RSAP_PLANNER_MOUNTED__ = true;
  const $=(q)=>document.querySelector(q);
  const $$=(q)=>Array.from(document.querySelectorAll(q));
  const fmt=(n)=> (Number(n)||0).toLocaleString('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0});
  const clamp01=(x)=>Math.max(0,Math.min(1,x));
  function pmti(P,r,n){ if(r===0) return P/n; const x=Math.pow(1+r,n); return P*(r*x)/(x-1); }
  const el={
    total:$('#in-total'), addl:$('#in-addl'),
    exCore:$('#ex-core'), exDisc:$('#ex-disc'),
    bpBtn:$('#btn-bp'), bpPanel:$('#bp-panel'),
    saveRate:$('#save-rate'),
    cs:$('#cs-slider'), csLabel:$('#cs-label'), aprLabel:$('#apr-label'),
    hPrice:$('#h-price'), dpSlider:$('#dp-slider'), dpPctLabel:$('#dp-pct-label'),
    dpAmtLabel:$('#dp-amt-label'), dpAmt:$('#dp-amt'),
    hRate:$('#h-rate'), hTerm:$('#h-term'), hTIHOA:$('#h-tihoa'), hPMI:$('#h-pmi'),
    btnCalc:$('#btn-calc'), btnClear:$('#btn-clear'),
    kIncome:$('#kpi-income'), kExp:$('#kpi-expenses'), kMortgage:$('#kpi-mortgage'),
    kSave:$('#kpi-savings'), kDisp:$('#kpi-disposable'),
    pie:$('#pie'), bars:$('#bars'),
    statusBox:$('#statusBox'), statusDot:$('#statusDot'), statusTitle:$('#statusTitle'),
    statusMsg:$('#statusMsg'), meterFill:$('#meterFill'),
    fidText:$('#fiduciaryText'),
    bpLoad:$('#bp-load'),
  };
  function scoreAPRLocal(score){
    const s=Number(score)||720;
    if(s>=780) return 6.50; if(s>=760) return 6.75; if(s>=720) return 7.00;
    if(s>=700) return 7.20; if(s>=680) return 7.35; if(s>=660) return 7.85;
    if(s>=640) return 8.25; if(s>=620) return 9.25; return 9.95;
  }
  let pieChart=null, barChart=null;
  function initCharts(){
    if (pieChart){ pieChart.destroy(); pieChart=null; }
    if (barChart){ barChart.destroy(); barChart=null; }
    pieChart = new Chart(el.pie.getContext('2d'), {
      type:'doughnut',
      data:{ labels:['Expenses','Savings','Housing','Disposable'],
        datasets:[{ data:[0,0,0,1], backgroundColor:['#6aa7ff','#8ef3c5','#f9c74f','#55d399'] }] },
      options:{
        plugins:{ legend:{ labels:{ color:'#cfd5ff' } } },
        cutout:'62%', responsive:true, maintainAspectRatio:false
      }
    });
    barChart = new Chart(el.bars.getContext('2d'), {
      type:'bar',
      data:{ labels:['Income','Expenses','Savings','Housing','Disposable'],
        datasets:[{ label:'Monthly $', data:[0,0,0,0,0],
          backgroundColor:['#55d399','#6aa7ff','#8ef3c5','#f9c74f','#9bd8c0'] }] },
      options:{
        plugins:{ legend:{ labels:{ color:'#cfd5ff' } } },
        scales:{ x:{ ticks:{ color:'#cfd5ff' } }, y:{ ticks:{ color:'#cfd5ff' } } },
        responsive:true, maintainAspectRatio:false
      }
    });
  }
  /* ---------- itemized budget store ---------- */
  let BP_ROWS=[], BP_ID=1;
  function bpTotals(){ const t={Essentials:0,Discretionary:0,Debt:0,Other:0};
    BP_ROWS.forEach(r=> t[r.cat]+=Number(r.month)||0);
    t.All=t.Essentials+t.Discretionary+t.Debt+t.Other; return t;
  }
  function bpTotalsUI(){
    const t=bpTotals();
    $('#bp-t-Essentials').textContent=fmt(t.Essentials);
    $('#bp-t-Discretionary').textContent=fmt(t.Discretionary);
    $('#bp-t-Debt').textContent=fmt(t.Debt);
    $('#bp-t-Other').textContent=fmt(t.Other);
    $('#bp-t-All').textContent=fmt(t.All);
  }
  function bpRender(){
    const tb=$('#bp-body'); if(!tb) return; tb.innerHTML='';
    BP_ROWS.forEach(r=>{
      const tr=document.createElement('tr'); tr.className='bp-tr';
      tr.innerHTML=`<td class="bp-td"><select class="va-select bp-cat" data-id="${r.id}">
          <option ${r.cat==='Essentials'?'selected':''}>Essentials</option>
          <option ${r.cat==='Discretionary'?'selected':''}>Discretionary</option>
          <option ${r.cat==='Debt'?'selected':''}>Debt</option>
          <option ${r.cat==='Other'?'selected':''}>Other</option>
        </select></td>
        <td class="bp-td"><input class="va-input bp-name" data-id="${r.id}" value="${r.name||''}"></td>
        <td class="bp-td" style="width:160px"><input class="va-input bp-month" data-id="${r.id}" type="number" min="0" step="1" value="${r.month||0}"></td>
        <td class="bp-td" style="width:120px">${fmt((r.month||0)*12)}</td>
        <td class="bp-td" style="width:80px"><button class="va-btn ghost bp-del" data-id="${r.id}">‚úï</button></td>`;
      tb.appendChild(tr);
    });
    $$('.bp-cat').forEach(x=>x.addEventListener('change',e=>{ const rr=BP_ROWS.find(z=>z.id==e.target.dataset.id); if(rr){rr.cat=e.target.value; bpTotalsUI();}}));
    $$('.bp-name').forEach(x=>x.addEventListener('input',e=>{ const rr=BP_ROWS.find(z=>z.id==e.target.dataset.id); if(rr) rr.name=e.target.value; }));
    $$('.bp-month').forEach(x=>x.addEventListener('input',e=>{ const rr=BP_ROWS.find(z=>z.id==e.target.dataset.id); if(rr){rr.month=Number(e.target.value)||0; bpTotalsUI();}}));
    $$('.bp-del').forEach(x=>x.addEventListener('click',e=>{ BP_ROWS=BP_ROWS.filter(r=>r.id!==Number(e.target.dataset.id)); bpRender(); }));
    bpTotalsUI();
  }
  $('#bp-add')?.addEventListener('click', ()=>{
    const cat=$('#bp-cat').value;
    const name=$('#bp-name').value.trim()||'Item';
    const m=Number($('#bp-month').value)||0;
    BP_ROWS.push({id:BP_ID++,cat,name,month:m});
    $('#bp-name').value=''; $('#bp-month').value='';
    bpRender();
  });
  $('#bp-save')?.addEventListener('click', ()=>{
    const t=bpTotals();
    const core=t.Essentials+t.Debt+t.Other;
    const disc=t.Discretionary;
    /* Keep old keys for compatibility + add RealtySaSS keys */
    localStorage.setItem('va.expenses.core', String(Math.round(core)));
    localStorage.setItem('va.expenses.disc', String(Math.round(disc)));
    localStorage.setItem('va.expenses.rows', JSON.stringify(BP_ROWS));
    localStorage.setItem('realtysass.afford.expenses.core', String(Math.round(core)));
    localStorage.setItem('realtysass.afford.expenses.disc', String(Math.round(disc)));
    localStorage.setItem('realtysass.afford.expenses.rows', JSON.stringify(BP_ROWS));
    $('#bp-note').textContent='Saved! Totals copied above.';
    el.exCore.value=Math.round(core);
    el.exDisc.value=Math.round(disc);
    render();
  });
  $('#bp-load')?.addEventListener('click', ()=>{
    BP_ROWS=[
      {id:1,cat:'Essentials',name:'Rent',month:1800},
      {id:2,cat:'Essentials',name:'Utilities',month:260},
      {id:3,cat:'Essentials',name:'Insurance',month:220},
      {id:4,cat:'Essentials',name:'Car Payment',month:420},
      {id:5,cat:'Discretionary',name:'Food & Dining',month:650},
      {id:6,cat:'Discretionary',name:'Subscriptions',month:110},
      {id:7,cat:'Debt',name:'Credit Cards',month:250}
    ];
    BP_ID=8; bpRender();
    const t=bpTotals(); el.exCore.value=Math.round(t.Essentials+t.Debt+t.Other); el.exDisc.value=Math.round(t.Discretionary);
    render();
    $('#bp-note').textContent='Example loaded. Edit amounts, then Save & Prefill to store.';
  });
  (function bpRestore(){
    try{
      const raw = localStorage.getItem('realtysass.afford.expenses.rows') || localStorage.getItem('va.expenses.rows');
      if(raw){
        BP_ROWS=JSON.parse(raw)||[];
        BP_ID=BP_ROWS.reduce((m,r)=>Math.max(m,r.id||0),0)+1;
        bpRender();
      }
      const core=+(
        localStorage.getItem('realtysass.afford.expenses.core') ||
        localStorage.getItem('va.expenses.core')
      )||0;
      const disc=+(
        localStorage.getItem('realtysass.afford.expenses.disc') ||
        localStorage.getItem('va.expenses.disc')
      )||0;
      if(core||disc){ el.exCore.value=core; el.exDisc.value=disc; }
    }catch(e){}
  })();
  function readNum(i){ return Number.parseFloat((i&&i.value)||'0')||0; }
  function compute(){
    const income = readNum(el.total) + readNum(el.addl);
    const expenses = readNum(el.exCore) + readNum(el.exDisc);
    const saveRate=(Number(el.saveRate.value)||0)/100;
    const savings = Math.max(0, income * saveRate);
    const inferredAPR = scoreAPRLocal(el.cs.value);
    const usedAPR = Number(el.hRate.value)||inferredAPR;
    const price = readNum(el.hPrice);
    const dpPct = (Number(el.dpSlider.value)||0)/100;
    const downAmount = Math.max(0, price * dpPct);
    const loan = Math.max(0, price - downAmount);
    const mRate = (usedAPR||0)/100/12;
    const nMonths = Math.max(1, (Number(el.hTerm.value)||30)*12);
    const pAndI = loan>0 ? pmti(loan, mRate, nMonths) : 0;
    const tihoa = readNum(el.hTIHOA);
    const pmi = readNum(el.hPMI);
    const housing = pAndI + tihoa + pmi;
    const freePost = income - expenses - savings - housing;
    const housingShare = income>0 ? housing/income : 0;
    const totalShare   = income>0 ? (expenses + savings + housing)/income : 0;
    const dti          = income>0 ? (expenses + housing)/income : 0;
    return {income,expenses,savings,housing,freePost,housingShare,totalShare,dti,loan,pAndI,dpPct,downAmount,inferredAPR,usedAPR};
  }
  function render(){
    const s=compute();
    el.kIncome.textContent=fmt(s.income);
    el.kExp.textContent=fmt(s.expenses);
    el.kSave.textContent=fmt(s.savings);
    el.kMortgage.textContent=fmt(s.housing);
    el.kDisp.textContent = s.freePost>=0 ? fmt(s.freePost) : ('-'+fmt(Math.abs(s.freePost)));
    const shareAfter = s.income>0 ? (s.freePost/s.income) : 0;
    let cls='neutral';
    if (s.freePost<0) cls='bad';
    else if (shareAfter>=.2) cls='good';
    else if (shareAfter>=.1) cls='warn';
    el.kDisp.className='';
    el.kDisp.classList.add(cls);
    if(!pieChart || !barChart) initCharts();
    /* Pie must never go negative */
    pieChart.data.datasets[0].data=[s.expenses,s.savings,s.housing,Math.max(0,s.freePost)];
    pieChart.update();
    /* Bar looks awful with negative; clamp disposable to 0 for visualization */
    barChart.data.datasets[0].data=[s.income,s.expenses,s.savings,s.housing,Math.max(0,s.freePost)];
    barChart.update();
    el.meterFill.style.width=(clamp01(s.totalShare)*100).toFixed(0)+'%';
    let title='Healthy Plan', msg='You remain cash-flow positive after expenses, savings, and housing.', cls2='ok', dot='var(--ok)';
    if (s.totalShare>=0.85 || s.freePost<0){ title='Risky: Overcommitted'; msg='This scenario likely overextends cash flow. Reduce price/rate/expenses.'; cls2='bad'; dot='var(--bad)'; }
    else if (s.totalShare>=0.70){ title='Caution Zone'; msg='Budget is tight. Aim for ‚â•15% buffer after all costs.'; cls2='warn'; dot='var(--warn)'; }
    el.statusBox.classList.remove('ok','warn','bad'); el.statusBox.classList.add(cls2);
    el.statusTitle.textContent=title;
    el.statusMsg.textContent=msg;
    el.statusDot.style.background=`${dot}`;
    const score=Number(el.cs.value)||720;
    const band=score>=760?'Excellent':score>=720?'Good':score>=680?'Fair':score>=640?'OK':score>=620?'Weak':'Subprime';
    el.csLabel.textContent=`${score} ‚Äì ${band}`;
    el.aprLabel.textContent=(s.inferredAPR||0).toFixed(2)+'%';
    el.dpPctLabel.textContent=(s.dpPct*100).toFixed(0)+'%';
    el.dpAmtLabel.textContent=fmt(s.downAmount);
    el.dpAmt.value=fmt(s.downAmount);
    const bullets=[];
    bullets.push(`Housing estimate ‚âà ${fmt(s.housing)} (${(s.housingShare*100).toFixed(1)}% of income).`);
    bullets.push(`P&I ‚âà ${fmt(s.pAndI)} on loan ‚âà ${fmt(s.loan)} @ ${Number(el.hRate.value||s.inferredAPR).toFixed(2)}% APR.`);
    bullets.push(`Disposable after housing: ${s.freePost>=0?fmt(s.freePost):('-'+fmt(Math.abs(s.freePost)))}.`);
    bullets.push(`Total committed share: ${(s.totalShare*100).toFixed(0)}%. Rough DTI: ${(s.dti*100).toFixed(0)}%.`);
    el.fidText.innerHTML='<ul style="margin:8px 0 0 18px">'+bullets.map(b=>`<li style="margin:6px 0">${b}</li>`).join('')+'</ul>';
  }
  function wire(){
    /* Toggle itemized budget */
    el.bpBtn.addEventListener('click', ()=>{
      el.bpPanel.classList.toggle('hidden');
      el.bpBtn.textContent = el.bpPanel.classList.contains('hidden') ? '‚ñº Itemized Monthly Budget (optional)' : '‚ñ≤ Itemized Monthly Budget (hide)';
    });
    /* Live updates */
    [el.total,el.addl,el.exCore,el.exDisc,el.hPrice,el.hRate,el.hTerm,el.hTIHOA,el.hPMI].forEach(i=> i && i.addEventListener('input', render));
    el.saveRate.addEventListener('input', ()=>{ $('#save-rate-label').textContent=el.saveRate.value+'%'; render(); });
    el.cs.addEventListener('input', ()=>{
      if(!el.hRate.dataset.touched){ el.hRate.value = scoreAPRLocal(el.cs.value).toFixed(2); }
      render();
    });
    el.hRate.addEventListener('input', ()=>{ el.hRate.dataset.touched='1'; render(); });
    const updDP=()=>{ const s=compute();
      el.dpPctLabel.textContent=(s.dpPct*100).toFixed(0)+'%';
      el.dpAmtLabel.textContent=fmt(s.downAmount);
      el.dpAmt.value=fmt(s.downAmount);
    };
    el.dpSlider.addEventListener('input', ()=>{ updDP(); render(); });
    el.hPrice.addEventListener('input', ()=>{ updDP(); render(); });
    el.btnCalc.addEventListener('click', render);
    el.btnClear.addEventListener('click', ()=>{
      $$('input').forEach(inp=>{ if(inp.type==='range') return; if(!inp.disabled) inp.value=''; });
      el.saveRate.value=15; $('#save-rate-label').textContent='15%';
      el.cs.value=720; el.hRate.value=scoreAPRLocal(720).toFixed(2); el.hRate.dataset.touched='';
      el.dpSlider.value=20;
      render();
    });
    initCharts();
    render();
  }
  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', wire, {once:true});
  else wire();
})();
</script>
    </div>
  </section>
  <section class="commercial">
    <div class="w-layout-blockcontainer container-full reviews-image no-max-width w-container">
      <div class="space-large-2"></div>
      <div data-delay="5000" data-animation="slide" class="slider-testimonial slide-up-animation w-slider" data-autoplay="false" data-easing="ease-in-out" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
        <div class="mask-testimonial w-slider-mask">
          <div class="slide w-slide">
            <div class="testimonial-text-wrapper-2">
              <h6>A.I¬†Driven Financial Analysis</h6>
              <h2>Provide your Customer with Insight</h2>
              <p class="max-width-36rem-2">Imagine have not a motivated Client, but one that is fully aware of his/her financial health, and Clear Understanding of their Buying Power! Now, Image him discovering his potential on Your Own Website. </p>
            </div>
            <div class="testimonial-image-wrapper">
              <div class="testimonial-client-wrapper-3"><img sizes="(max-width: 767px) 100vw, (max-width: 991px) 728px, 800px" srcset="images/b4ab8f37201140495c2b4eb2080e3216_RS-p-500.png 500w, images/RS.png 800w" alt="Logo" src="images/RS.png" loading="eager" class="image-small-circle-02">
                <div class="testimonial-info-wrapper">
                  <div class="stars-wrapper"><img loading="eager" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="eager" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="eager" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="eager" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="eager" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"></div>
                  <h6 class="color-white centered-on-mobile">Financial Analysis Calculator with A.I¬†Fidicuary Analysis.</h6>
                </div>
              </div>
            </div>
          </div>
          <div class="slide w-slide">
            <div class="testimonial-text-wrapper-2">
              <h6>TESTIMONIALS</h6>
              <h2>Client Reviews</h2>
              <p class="max-width-36rem-2">High-end Realty&#x27;s attention to detail and negotiation skills were truly remarkable. What impressed me the most was their dedication to ensuring every aspect of the transaction was handled flawlessly.</p>
            </div>
            <div class="testimonial-image-wrapper">
              <div class="testimonial-client-wrapper-3"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779263_office%20guy.webp" alt="" class="image-small-circle-02">
                <div class="testimonial-info-wrapper">
                  <div class="stars-wrapper"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"></div>
                  <h6 class="color-white centered-on-mobile">Alexander Hayes</h6>
                </div>
              </div><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779168_quote.png" alt="" class="testimonial-icon-02 invert">
            </div>
          </div>
          <div class="slide w-slide">
            <div class="testimonial-text-wrapper-2">
              <h6>TESTIMONIALS</h6>
              <h2>Client Reviews</h2>
              <p class="max-width-36rem-2">When it comes to luxury real estate, High-end Realty is in a league of its own. From the first consultation to the final closing, their team demonstrated an exceptional level of professionalism.</p>
            </div>
            <div class="testimonial-image-wrapper">
              <div class="testimonial-client-wrapper-3"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779179_apuesto-joven-empresario-traje-Flip-Square.webp" alt="" class="image-small-circle-02">
                <div class="testimonial-info-wrapper">
                  <div class="stars-wrapper"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779167_star.png" alt="" class="star-2"></div>
                  <h6 class="color-white centered-on-mobile">Christian Cooper</h6>
                </div>
              </div><img loading="lazy" src="https://cdn.prod.website-files.com/697fe2c721f90c643e779123/697fe2ca21f90c643e779168_quote.png" alt="" class="testimonial-icon-02 invert">
            </div>
          </div>
        </div>
        <div class="left-arrow w-slider-arrow-left">
          <div class="w-icon-slider-left"></div>
        </div>
        <div class="right-arrow w-slider-arrow-right">
          <div class="w-icon-slider-right"></div>
        </div>
        <div class="slide-nav-testimonial-2 w-slider-nav w-round"></div>
      </div>
      <div class="space-large-2"></div>
    </div>
  </section>
  <section class="section-262"></section>
  <section>
    <div class="w-embed w-script"><!--  Fiduciary Snapshot (key-gated, responsive charts, Elena guidance)  -->
      <div id="fid-snapshot" style="all: initial;">
        <style>
    /* ============================================================
      House of SaSS ‚Ä¢ Fiduciary Snapshot ‚Äî THEME + FULL-BLEED FIX
      - Breaks out of Webflow container (100vw) so it won‚Äôt look ‚Äúskinny‚Äù
      - House of SaSS tokens + glass panels + teal/sapphire accents
    ============================================================ */
    #fid-snapshot, #fid-snapshot *{
      box-sizing:border-box;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    /* Tokens */
    #fid-snapshot{
      --bg:#0b0e1a;
      --panelA:#101426;
      --panelB:#0f1324;
      --card:#0f1428;
      --ink:#e9ecff;
      --sub:#a8b0d6;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.07);
      --teal:#8ef3c5;
      --blue:#6aa7ff;
      --ok:#55d399;
      --warn:#f9c74f;
      --bad:#ff6b6b;
      --shadow:0 24px 48px rgba(0,0,0,.80);
      --shadowSoft:0 10px 24px rgba(0,0,0,.35);
    }
    /* --------- FULL-BLEED BREAKOUT (fixes your skinny-left issue) --------- */
    #fid-snapshot .wrap{
      width:100vw;
      margin-left:calc(50% - 50vw);
      padding:18px 16px 56px;
      color:var(--ink);
    }
    /* Main card centered */
    #fid-snapshot .card{
      max-width:1120px;
      margin:0 auto;
      padding:18px;
      position:relative;
      border-radius:18px;
      border:1px solid var(--line2);
      background:
        radial-gradient(1200px 500px at 18% 0%, rgba(142,243,197,.14), transparent 55%),
        radial-gradient(900px 420px at 92% 18%, rgba(106,167,255,.14), transparent 55%),
        linear-gradient(180deg, var(--panelA), var(--panelB));
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    /* subtle grid texture (very light) */
    #fid-snapshot .card:before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size:120px 120px;
      opacity:.06;
      pointer-events:none;
    }
    /* Frosted overlay */
    #fid-snapshot .frost{
      position:absolute;
      inset:0;
      border-radius:12px;
      background:rgba(12,14,25,0.62);
      backdrop-filter:blur(8px) saturate(1.08);
      -webkit-backdrop-filter:blur(8px) saturate(1.08);
      border:1px solid rgba(255,255,255,0.08);
      display:grid;
      place-items:center;
      opacity:1;
      pointer-events:auto;
      transition:opacity .25s;
    }
    #fid-snapshot.unlocked .frost{ opacity:0; pointer-events:none; }
    /* key row */
    #fid-snapshot .row{
      display:grid;
      grid-template-columns:1fr auto;
      gap:12px;
      align-items:center;
      position:relative;
      z-index:2;
    }
    @media (max-width:720px){
      #fid-snapshot .row{ grid-template-columns:1fr; }
    }
    #fid-snapshot .kbox{
      background:rgba(12,14,25,0.65);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
      box-shadow:var(--shadowSoft);
    }
    #fid-snapshot .kbox label{
      display:block;
      color:var(--sub);
      font-size:11px;
      margin-bottom:8px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    #fid-snapshot .input{
      width:100%;
      background:rgba(12,14,25,0.65);
      border:1px solid rgba(255,255,255,.10);
      color:var(--ink);
      border-radius:12px;
      padding:12px;
      font-size:14px;
      outline:none;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.15);
    }
    #fid-snapshot .input:focus{
      border-color:rgba(142,243,197,.85);
      box-shadow:0 0 0 1px rgba(142,243,197,.25), 0 14px 30px rgba(0,0,0,.55);
    }
    #fid-snapshot .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(160px 80px at 30% 50%, rgba(142,243,197,.20), transparent 60%),
        radial-gradient(160px 80px at 70% 50%, rgba(106,167,255,.20), transparent 60%),
        rgba(12,14,25,0.65);
      box-shadow:var(--shadowSoft);
      position:relative;
      z-index:2;
      white-space:nowrap;
    }
    #fid-snapshot .dot{ width:10px; height:10px; border-radius:50%; }
    /* charts grid */
    #fid-snapshot .charts{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:12px;
      position:relative;
      z-index:2;
    }
    @media (max-width:900px){
      #fid-snapshot .charts{ grid-template-columns:1fr; }
    }
    #fid-snapshot .card-mini{
      background:rgba(12,14,25,0.65);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:12px;
      min-height:220px;
      display:flex;
      flex-direction:column;
      box-shadow:var(--shadowSoft);
      overflow:hidden;
    }
    #fid-snapshot .card-mini h3{
      margin:0 0 8px;
      font-size:14px;
      color:var(--ink);
      font-weight:800;
      letter-spacing:.02em;
    }
    /* responsive canvas container */
    #fid-snapshot .chart-holder{
      position:relative;
      height: clamp(200px, 36vh, 380px);
      width: 100%;
      display:block;
      overflow: hidden;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    #fid-snapshot canvas{
      width:100% !important;
      height:100% !important;
      display:block;
    }
    /* KPIs */
    #fid-snapshot .kpi{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
      margin-top:12px;
      position:relative;
      z-index:2;
    }
    @media (max-width:900px){
      #fid-snapshot .kpi{ grid-template-columns:1fr; }
    }
    #fid-snapshot .k{
      background:rgba(12,14,25,0.65);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
      box-shadow:var(--shadowSoft);
    }
    #fid-snapshot .k small{
      color:var(--sub);
      font-size:11px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    #fid-snapshot .k b{
      display:block;
      margin-top:6px;
      font-size:16px;
      letter-spacing:.01em;
    }
    #fid-snapshot b.good{ color:var(--ok) }
    #fid-snapshot b.warn{ color:var(--warn) }
    #fid-snapshot b.bad{ color:var(--bad) }
    #fid-snapshot b.neutral{ color:var(--ink) }
    /* sections */
    #fid-snapshot .blk{
      background:rgba(12,14,25,0.65);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:16px;
      margin-top:12px;
      position:relative;
      box-shadow:var(--shadowSoft);
      overflow:hidden;
      z-index:2;
    }
    #fid-snapshot .blk h3{
      margin:0 0 6px;
      font-size:16px;
      font-weight:900;
      letter-spacing:.02em;
    }
    #fid-snapshot .note{ color:var(--sub); font-size:12px; }
    #fid-snapshot .muted{ color:var(--sub); font-size:11px; opacity:.95; }
    /* lock chip */
    #fid-snapshot .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      color:#050712;
      background:radial-gradient(circle at 30% 30%, var(--teal), var(--blue));
      box-shadow:0 14px 30px rgba(0,0,0,.55);
      border:0;
      font-weight:800;
      letter-spacing:.02em;
    }
  </style>
        <div class="wrap">
          <div class="card" id="fid-card">
            <div class="row">
              <div class="kbox">
                <label>ENTER ACTIVATION KEY</label>
                <input id="fid-key" class="input" placeholder="e.g., 9563379087">
                <div class="muted">Enter the code provided by your advisor to unlock analysis. (Hint: 956-337-9087)</div>
              </div>
              <span class="badge"><span id="fid-dot" class="dot" style="background:#888"></span><b id="fid-grade">Locked</b></span>
            </div>
            <div class="charts">
              <div class="card-mini">
                <h3>Visual Budget</h3>
                <div class="chart-holder">
                  <canvas id="fid-pie"></canvas>
                  <div class="frost"><span class="chip">üîí Locked</span></div>
                </div>
                <div class="muted" style="margin-top:6px">Income allocation: Expenses, Savings, Housing, Disposable.</div>
              </div>
              <div class="card-mini">
                <h3>Itemized Monthly Budget</h3>
                <div class="chart-holder">
                  <canvas id="fid-bars"></canvas>
                  <div class="frost"><span class="chip">üîí Locked</span></div>
                </div>
                <div class="muted" style="margin-top:6px">Top items from your saved budget (Planner) ‚Äî often grouped.</div>
              </div>
            </div>
            <div class="kpi">
              <div class="k"><small>Disposable After Housing</small><b id="k-after" class="neutral">$0</b></div>
              <div class="k"><small>Housing Share of Income</small><b id="k-hshare">0%</b></div>
              <div class="k"><small>Total Committed Share</small><b id="k-tshare">0%</b></div>
            </div>
            <div class="kpi" style="grid-template-columns:repeat(3,minmax(0,1fr))">
              <div class="k"><small>DTI (rough)</small><b id="k-dti">0%</b></div>
              <div class="k"><small>LTV</small><b id="k-ltv">0%</b></div>
              <div class="k"><small>Credit Score ‚Üí APR</small><b id="k-score">720 ‚Üí 7.00%</b></div>
            </div>
            <div class="blk">
              <h3>Fiduciary Guidance</h3>
              <div id="fid-guidance" class="note">Enter key to unlock.</div>
              <div class="frost"><span class="chip">üîí Locked</span></div>
            </div>
            <div class="blk">
              <h3>Assumptions & Notes</h3>
              <div id="fid-assump" class="note">Enter key to unlock.</div>
              <div class="frost"><span class="chip">üîí Locked</span></div>
            </div>
            <div class="muted" style="margin-top:10px">Outputs are educational, not advice.</div>
          </div>
        </div>
        <!--  Chart.js  -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
        <script>
  (()=> {
    if (window.__FIDUCIARY_WIDGET_MOUNTED__) return;
    window.__FIDUCIARY_WIDGET_MOUNTED__ = true;
    const UNLOCK_KEY_NUM = "9563379087";
    /* ---------- utils ---------- */
    const $=(q)=>document.querySelector(q);
    const onlyDigits=(s)=> String(s||'').replace(/\D+/g,'');
    const cur=(n,d=0)=> (Number(n)||0).toLocaleString('en-US',{style:'currency',currency:'USD',minimumFractionDigits:d,maximumFractionDigits:d});
    const pct=(x,d=0)=> ((Number(x)||0)*100).toFixed(d)+'%';
    const read=(id)=> Number.parseFloat((document.getElementById(id)?.value||'0'))||0;
    const clean=(t)=> (t||'').replace(/\s+/g,' ').trim();
    const looksMoney=(t)=> /^\s*(\$|¬£|‚Ç¨)?\s*\d[\d,]*(\.\d+)?\s*$/.test(t||'');
    function pmti(P,r,n){ if(r===0) return P/n; const x=Math.pow(1+r,n); return P*(r*x)/(x-1); }
    function scoreAPR(s){ s=Number(s)||720;
      if(s>=780) return 6.50; if(s>=760) return 6.75; if(s>=720) return 7.00; if(s>=700) return 7.20;
      if(s>=680) return 7.35; if(s>=660) return 7.85; if(s>=640) return 8.25; if(s>=620) return 9.25; return 9.95; }
    /* ---------- snapshot ---------- */
    function snapshot(){
      const income   = read('in-total') + read('in-addl');
      const expenses = read('ex-core') + read('ex-disc');
      const saveRate = (Number(document.getElementById('save-rate')?.value)||0)/100;
      const savings  = Math.max(0, income * saveRate);
      const price = read('h-price');
      const dpPct = (Number(document.getElementById('dp-slider')?.value)||0)/100;
      const dpAmt = Math.max(0, price * dpPct);
      const loan  = Math.max(0, price - dpAmt);
      const score = Number(document.getElementById('cs-slider')?.value)||720;
      const inferredAPR = scoreAPR(score);
      const apr = Number(document.getElementById('h-rate')?.value)||inferredAPR;
      const termY = Number(document.getElementById('h-term')?.value)||30;
      const mRate = (apr||0)/100/12;
      const pAndI = loan>0 ? pmti(loan, mRate, termY*12) : 0;
      const tihoa = read('h-tihoa');
      const pmi   = read('h-pmi');
      const housing = pAndI + tihoa + pmi;
      const freePre  = income - expenses - savings;
      const freePost = income - expenses - savings - housing;
      const housingShare = income>0 ? housing/income : 0;
      const totalShare   = income>0 ? (expenses + savings + housing)/income : 0;
      const dti          = income>0 ? (expenses + housing)/income : 0;
      const ltv          = price>0 ? (loan/price) : 0;
      return {income,expenses,savings,freePre,freePost,housing,housingShare,totalShare,dti,price,dpPct,dpAmt,loan,score,apr,inferredAPR,termY,ltv,tihoa,pmi,pAndI};
    }
    /* ---------- planner section (outside widget) ---------- */
    function findPlannerSection(){
      const root = document.getElementById('fid-snapshot');
      const nodes = Array.from(document.querySelectorAll('h1,h2,h3,h4,summary,button,div,span'))
        .filter(n=>{
          const t = clean(n.textContent).toLowerCase();
          return t && t.includes('itemized monthly budget') && !root.contains(n);
        });
      for(const n of nodes){ if(n.offsetParent!==null) return n.closest('section,fieldset,form,div') || n.parentElement; }
      return null;
    }
    /* ---------- read rows ---------- */
    const BAD_LABEL = /^(category|item|monthly|annual|del|delete|essentials|discretionary|debt|other)$/i;
    function valueFrom(el){
      if(!el) return 0; const raw = (el.value ?? el.textContent ?? '').toString();
      return Number(raw.replace(/[^0-9.-]/g,'')) || 0;
    }
    function extractNameFromRow(row){
      if(!row) return 'Item';
      const txt = row.querySelector('input[type="text"], textarea, [contenteditable="true"]');
      if(txt){
        const v = clean(txt.value || txt.textContent || txt.getAttribute('value') || txt.getAttribute('placeholder'));
        if(v && !BAD_LABEL.test(v) && !looksMoney(v)) return v;
      }
      const leafs = Array.from(row.querySelectorAll('*')).filter(n=>n.children.length===0);
      for(const n of leafs){
        const t=clean(n.textContent);
        if(t && t.length<=48 && !BAD_LABEL.test(t) && !looksMoney(t)) return t;
      }
      return 'Item';
    }
    function getItemizedFromDOM(){
      const section = findPlannerSection();
      if(!section) return [];
      const table = section.querySelector('table');
      if(table){
        const out=[], rows = Array.from(table.querySelectorAll('tbody tr')).filter(r=>r.offsetParent!==null);
        for(const tr of rows){
          const monthCell = tr.querySelector('td:nth-child(3), td[aria-label*="monthly" i]') || tr;
          const month = valueFrom(monthCell.querySelector('input, [contenteditable="true"]')) || valueFrom(monthCell);
          if(month<=0) continue;
          const itemCell = tr.querySelector('td:nth-child(2), td.item, td[aria-label*="item" i]') || tr;
          out.push({ name: extractNameFromRow(itemCell), month });
        }
        if(out.length) return out;
      }
      const delBtns = Array.from(section.querySelectorAll('button,[role="button"]'))
        .filter(b=>{
          const t=clean(b.textContent).toLowerCase();
          const ar=(b.getAttribute('aria-label')||'').toLowerCase();
          return t==='x'||t==='√ó'||ar.includes('delete')||ar==='del'||ar==='remove';
        });
      const out=[];
      for(const d of delBtns){
        const row = d.closest('tr,li,.row,.budget-row,.itm-row,[class*="row"],[class*="grid"],div');
        if(!row || row.offsetParent===null) continue;
        const month = valueFrom(row.querySelector('input[placeholder*="$" i], input[aria-label*="monthly" i], input[name*="month" i], [contenteditable="true"], [data-amount]'));
        if(month<=0) continue;
        out.push({ name: extractNameFromRow(row), month });
      }
      return out;
    }
    function getItemizedFromStorage(){
      const keys=['va.expenses.rows','planner.itemized.rows','itemizedMonthlyBudget'];
      for(const k of keys){
        try{
          const raw = localStorage.getItem(k);
          if(!raw) continue;
          const arr = JSON.parse(raw)||[];
          const rows = arr.map(r=>({name:String(r.name||r.item||r.label||'Item'), month:Number(r.month||r.monthly||r.amount||r.value||0)||0}))
                          .filter(r=>r.month>0);
          if(rows.length) return rows;
        }catch(e){}
      }
      return [];
    }
    function getItemizedRows(){
      const domRows = getItemizedFromDOM();
      return domRows.length ? domRows : getItemizedFromStorage();
    }
    /* ---------- labelize (fallback names if missing) ---------- */
    const FALLBACK_LABELS = ['Rent','Groceries','Dining','Utilities','Insurance','Transportation','Internet/Phone','Subscriptions','Other'];
    function labelize(rows){
      if(!rows.length) return rows;
      const badCount = rows.filter(r=>!r.name || /^item$/i.test(r.name.trim())).length;
      if(badCount / rows.length >= 0.6){
        const sorted = [...rows].sort((a,b)=>b.month-a.month);
        for(let i=0;i<sorted.length;i++){
          const label = FALLBACK_LABELS[Math.min(i, FALLBACK_LABELS.length-1)];
          sorted[i].name = label;
        }
        return sorted;
      }
      return rows;
    }
    /* ---------- charts ---------- */
    let pieChart=null, barChart=null;
    function destroyIfExists(id){ const ex = window.Chart && Chart.getChart(id); if (ex) ex.destroy(); }
    function initCharts(){
      destroyIfExists('fid-pie'); destroyIfExists('fid-bars');
      if(pieChart){ pieChart.destroy(); pieChart=null; }
      if(barChart){ barChart.destroy(); barChart=null; }
      pieChart = new Chart(document.getElementById('fid-pie').getContext('2d'),{
        type:'doughnut',
        data:{ labels:['Expenses','Savings','Housing','Disposable'],
          datasets:[{ data:[0,0,0,1], backgroundColor:['#6aa7ff','#8ef3c5','#f9c74f','#55d399'] }] },
        options:{
          plugins:{ legend:{ labels:{ color:'#cfd5ff' } } },
          cutout:'62%',
          responsive:true,
          maintainAspectRatio:false
        }
      });
      barChart = new Chart(document.getElementById('fid-bars').getContext('2d'),{
        type:'bar',
        data:{ labels:[], datasets:[{ label:'Monthly $', data:[], backgroundColor:'#8ef3c5' }] },
        options:{
          indexAxis:'y',
          plugins:{
            legend:{ labels:{ color:'#cfd5ff' } },
            tooltip:{ callbacks:{ label:(ctx)=> cur(ctx.raw) } }
          },
          scales:{
            x:{ ticks:{ color:'#cfd5ff' }, grid:{ color:'rgba(255,255,255,.08)' } },
            y:{ ticks:{ color:'#cfd5ff' }, grid:{ color:'rgba(255,255,255,.06)' } }
          },
          responsive:true,
          maintainAspectRatio:false
        }
      });
      // keep charts perfectly sized with container using ResizeObserver
      const holders = document.querySelectorAll('#fid-snapshot .chart-holder');
      const ro = new ResizeObserver(()=>{ pieChart?.resize(); barChart?.resize(); });
      holders.forEach(h=> ro.observe(h));
    }
    function updateItemizedBars(){
      if(!barChart) return;
      let rows = getItemizedRows();
      rows = labelize(rows);
      if(!rows.length){
        const s = snapshot();
        rows = [
          ['Rent', s.housing],
          ['Groceries',       Math.round(s.expenses*0.28)],
          ['Dining',          Math.round(s.expenses*0.17)],
          ['Utilities',       Math.round(s.expenses*0.12)],
          ['Insurance',       Math.round(s.expenses*0.10)],
          ['Transportation',  Math.round(s.expenses*0.15)],
          ['Internet/Phone',  Math.round(s.expenses*0.10)],
          ['Subscriptions',   Math.round(s.expenses*0.08)]
        ].filter(([_,v])=>v>0).map(([n,v])=>({name:n,month:v}));
      }
      rows.sort((a,b)=> b.month - a.month);
      const top = rows.slice(0,8);
      const rest = rows.slice(8);
      const other = rest.reduce((m,r)=>m+r.month,0);
      barChart.data.labels = top.map(r=>r.name).concat(other>0?['Other']:[]);
      barChart.data.datasets[0].data = top.map(r=>r.month).concat(other>0?[other]:[]);
      barChart.update();
    }
    function updateCharts(s){
      if(!pieChart || !barChart) return;
      pieChart.data.datasets[0].data = [s.expenses, s.savings, s.housing, Math.max(0,s.freePost)];
      pieChart.update();
      updateItemizedBars();
    }
    /* ---------- KPIs & lock ---------- */
    function localGrade(s){
      let g=92;
      if(s.totalShare>=0.85) g-=30; else if(s.totalShare>=0.70) g-=15; else g+=4;
      if(s.housingShare>0.40) g-=18; else if(s.housingShare>0.33) g-=8; else g+=4;
      if(s.freePost<0) g-=30; else if((s.freePost/s.income)<0.10) g-=10; else if((s.freePost/s.income)>=0.20) g+=4;
      const sr=s.savings/(s.income||1); if(sr<0.10) g-=8; else if(sr>=0.20) g+=4;
      if(s.score>=760) g+=3; else if(s.score<640) g-=12; else if(s.score<620) g-=18;
      if(s.ltv>0.95) g-=14; else if(s.ltv>0.80) g-=6; else g+=3;
      g=Math.max(0,Math.min(100,g));
      const letter = g>=98?'A+': g>=92?'A': g>=88?'A-'
                   : g>=82?'B+': g>=76?'B': g>=72?'B-'
                   : g>=66?'C+': g>=60?'C': g>=55?'C-'
                   : g>=50?'D+': g>=45?'D':'F';
      return {g,letter};
    }
    /* ---------- Elena guidance ---------- */
    function buildElena(s){
      const sr = s.income>0 ? s.savings/s.income : 0;
      const buffer = s.income>0 ? s.freePost/s.income : 0;
      const targets = {
        housingMax: 0.31,
        dtiMax:     0.43,
        saveMin:    0.20,
        bufferMin:  0.15,
        ltvGoal:    0.80,
      };
      const good=[], watch=[], risks=[], actions=[];
      const why = (msg)=> `‚Äî ${msg}`;
      if (s.housingShare <= targets.housingMax) {
        good.push(`Housing at ${pct(s.housingShare,0)} ${why('inside the preferred ‚â§31% band.')}`);
      } else {
        watch.push(`Housing at ${pct(s.housingShare,0)} ${why('above comfort; buffer gets squeezed fast.')}`);
        actions.push(`Test a lower price band or increase down payment +2‚Äì5% to pull housing closer to ‚â§31%.`);
      }
      if (s.dti <= 0.36) {
        good.push(`DTI ${pct(s.dti,0)} ${why('healthy; underwriting feels easier under ~36%.')}`);
      } else if (s.dti <= targets.dtiMax) {
        watch.push(`DTI ${pct(s.dti,0)} ${why('workable but tight; >~43% gets hard.')}`);
        actions.push(`Trim recurring debts or reduce housing target ‚Äî even $100/mo helps approvals.`);
      } else {
        risks.push(`DTI ${pct(s.dti,0)} ${why('outside typical approval lanes.')}`);
        actions.push(`Defer purchase, reduce price, or pay down revolving balances to get under 43%.`);
      }
      if (sr >= 0.20) {
        good.push(`Savings rate ${pct(sr,0)} ${why('strong ‚Äî this is the ‚ÄúIvy‚Äù lane.')}`);
      } else if (sr >= 0.12) {
        watch.push(`Savings ${pct(sr,0)} ${why('decent, but 20% is the stretch target while shopping.')}`);
        actions.push(`Auto-raise transfers by +5% of income during home search; hold in HYSA.`);
      } else {
        risks.push(`Savings ${pct(sr,0)} ${why('thin cushion for repairs/move-in volatility.')}`);
        actions.push(`Run a 90-day savings sprint: +8‚Äì10% while cutting discretionary spend.`);
      }
      if (buffer >= targets.bufferMin) {
        good.push(`Post-housing buffer ${pct(buffer,0)} (${cur(s.freePost)}) ${why('breathing room + safety.')}`);
      } else if (buffer > 0) {
        watch.push(`Post-housing buffer ${pct(buffer,0)} (${cur(s.freePost)}) ${why('lean; surprises will hurt.')}`);
        actions.push(`Aim for ‚â•15% buffer by lowering housing or trimming $${Math.round(Math.max(0, (targets.bufferMin-buffer)*s.income))}/mo.`);
      } else {
        risks.push(`Negative after housing (${cur(s.freePost)}) ${why('not sustainable without credit.')}`);
        actions.push(`Reduce target payment or rebuild buffer before proceeding.`);
      }
      const aprText = (s.apr||s.inferredAPR).toFixed(2)+'%';
      if (s.score >= 740) {
        good.push(`Score ${s.score} ‚Üí competitive APR territory (~${aprText}).`);
      } else if (s.score >= 700) {
        watch.push(`Score ${s.score} ‚Üí ~${aprText}. Improving score can drop payment meaningfully.`);
        actions.push(`Lower utilization to <10% for 30 days, then re-pull rate quotes.`);
      } else {
        risks.push(`Score ${s.score} ‚Üí higher APR (~${aprText}).`);
        actions.push(`Dispute errors, avoid new pulls, and use rapid-rescore after utilization drops.`);
      }
      if (s.ltv > 0.80) {
        watch.push(`LTV ${pct(s.ltv,0)} with PMI likely.`);
        actions.push(`Plan PMI removal once you reach ‚â§80% LTV (value/equity) ‚Äî often 18‚Äì30 months.`);
      } else {
        good.push(`LTV ${pct(s.ltv,0)} ‚Äî strong equity start.`);
      }
      const intro = `Here‚Äôs your quick Ivy review ‚Äî straight from Elena‚Äôs desk:`;
      const targetsLine = `Targets ‚Ä¢ Housing ‚â§31% ‚Ä¢ DTI ‚â§36% (hard cap ‚âà43%) ‚Ä¢ Savings ‚â•20% ‚Ä¢ Buffer ‚â•15% ‚Ä¢ LTV ‚â§80%.`;
      const bullets = [
        good.length?`‚úÖ What‚Äôs working:\n${good.map(x=>`‚Äî ${x}`).join('\n')}`:'',
        watch.length?`‚ö†Ô∏è Keep an eye on:\n${watch.map(x=>`‚Äî ${x}`).join('\n')}`:'',
        risks.length?`‚ùå Red flags:\n${risks.map(x=>`‚Äî ${x}`).join('\n')}`:'',
        actions.length?`üõ†Ô∏è Knobs that move the needle:\n${actions.map(x=>`‚Äî ${x}`).join('\n')}`:''
      ].filter(Boolean);
      return [intro, targetsLine, ...bullets];
    }
    function localAssumptions(s){
      return [
        `P&I from loan ${cur(s.loan)} at ${(s.apr||s.inferredAPR).toFixed(2)}% for ${s.termY} yrs.`,
        `Taxes/Insurance/HOA entered by you: ${cur(s.tihoa)}/mo.`,
        `PMI entered by you: ${cur(s.pmi)}/mo.`,
        `Down payment ${(s.dpPct*100).toFixed(0)}% ‚Üí ${cur(s.dpAmt)}; LTV ${(s.ltv*100).toFixed(0)}%.`,
        `Ratios ‚Äî Housing ${pct(s.housingShare)}, Total ${pct(s.totalShare)}, DTI ${pct(s.dti)}.`
      ];
    }
    /* ---------- paint & lock ---------- */
    function paintTop(){
      const s=snapshot();
      const after=$('#k-after');
      after.textContent = s.freePost>=0 ? cur(s.freePost) : ('-'+cur(Math.abs(s.freePost)));
      after.className = s.freePost<0 ? 'bad' : ((s.freePost/s.income)>=0.20 ? 'good' : ((s.freePost/s.income)>=0.10 ? 'warn' : 'neutral'));
      $('#k-hshare').textContent = pct(s.housingShare,0);
      $('#k-tshare').textContent = pct(s.totalShare,0);
      $('#k-dti').textContent    = pct(s.dti,0);
      $('#k-ltv').textContent    = pct(s.ltv,0);
      const score = Number(document.getElementById('cs-slider')?.value)||720;
      const aprUsed = Number(document.getElementById('h-rate')?.value) || scoreAPR(score);
      $('#k-score').textContent  = `${score} ‚Üí ${aprUsed.toFixed(2)}%`;
      const g = localGrade({...s,score});
      $('#fid-grade').textContent = `${g.letter} ‚Ä¢ snapshot`;
      $('#fid-dot').style.background = (g.letter[0]==='A'||g.letter[0]==='B')?'#55d399':(g.letter[0]==='C'?'#f9c74f':'#ff6b6b');
      updateCharts(s);
      return s;
    }
    function locked(){
      const entered = onlyDigits(($('#fid-key').value||'').trim());
      return entered !== UNLOCK_KEY_NUM;
    }
    function renderLockedState(){
      const isLocked = locked();
      const root = document.getElementById('fid-snapshot');
      if (isLocked) root.classList.remove('unlocked'); else root.classList.add('unlocked');
      if(isLocked){ $('#fid-grade').textContent='Locked'; $('#fid-dot').style.background='#888'; }
    }
    /* ---------- wires ---------- */
    ['in-total','in-addl','ex-core','ex-disc','save-rate','cs-slider','h-price','dp-slider','h-rate','h-term','h-tihoa','h-pmi']
      .forEach(id=>{
        const n=document.getElementById(id);
        if(n){ n.addEventListener('input', ()=>{
          const s=paintTop();
          if(!locked()){
            const el = buildElena(s);
            $('#fid-guidance').innerHTML = '<div style="white-space:pre-line; line-height:1.5">'+el.join('\n\n')+'</div>';
            $('#fid-assump').innerHTML   = '<ul style="margin:8px 0 0 18px">'+localAssumptions(s).map(x=>`<li style="margin:6px 0">${x}</li>`).join('')+'</ul>';
          }
        });}
      });
    $('#fid-key').addEventListener('input', ()=>{
      const s=paintTop();
      const el = buildElena(s);
      $('#fid-guidance').innerHTML = '<div style="white-space:pre-line; line-height:1.5">'+el.join('\n\n')+'</div>';
      $('#fid-assump').innerHTML   = '<ul style="margin:8px 0 0 18px">'+localAssumptions(s).map(x=>`<li style="margin:6px 0">${x}</li>`).join('')+'</ul>';
      renderLockedState();
    });
    // re-render bars when itemized rows change
    let __debounce;
    document.addEventListener('input', (e)=>{
      const t=e.target;
      if(!(t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement)) return;
      const ph=(t.placeholder||'').toLowerCase();
      const ar=(t.getAttribute('aria-label')||'').toLowerCase();
      const nm=(t.name||'').toLowerCase();
      if(!(ph.includes('monthly')||ph.includes('name')||ar.includes('monthly')||ar.includes('name')||/month|amount|item/.test(nm))) return;
      clearTimeout(__debounce);
      __debounce = setTimeout(updateItemizedBars, 200);
    });
    window.addEventListener('storage', (ev)=>{
      if(['va.expenses.rows','planner.itemized.rows','itemizedMonthlyBudget'].includes(ev.key)) updateItemizedBars();
    });
    /* ---------- first mount ---------- */
    initCharts();
    const s0 = paintTop();
    const el = buildElena(s0);
    $('#fid-guidance').innerHTML = '<div style="white-space:pre-line; line-height:1.5">'+el.join('\n\n')+'</div>';
    $('#fid-assump').innerHTML   = '<ul style="margin:8px 0 0 18px">'+localAssumptions(s0).map(x=>`<li style="margin:6px 0">${x}</li>`).join('')+'</ul>';
    renderLockedState();
    updateItemizedBars();
  })();
  </script>
      </div>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=697e270fb126ef5fe6610167" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>
</html>