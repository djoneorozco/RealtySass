<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Mon Sep 15 2025 14:38:18 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="68bd81c034845d434f49e5fc" data-wf-site="68ab0c767e65bfdde9efba3b" lang="en">
<head>
  <meta charset="utf-8">
  <title>RE-Defined</title>
  <meta content="Explore luxury on High-End Realty&#x27;s sleek site. Customize our responsive real estate Webflow template effortlessly. Connect to our powerful CMS and E-commerce today." name="description">
  <meta content="RE-Defined" property="og:title">
  <meta content="Explore luxury on High-End Realty&#x27;s sleek site. Customize our responsive real estate Webflow template effortlessly. Connect to our powerful CMS and E-commerce today." property="og:description">
  <meta content="https://cdn.prod.website-files.com/6688dd0add61af9d990077eb/66def8f549c69f8ce8ca8210_SEO.jpg" property="og:image">
  <meta content="RE-Defined" property="twitter:title">
  <meta content="Explore luxury on High-End Realty&#x27;s sleek site. Customize our responsive real estate Webflow template effortlessly. Connect to our powerful CMS and E-commerce today." property="twitter:description">
  <meta content="https://cdn.prod.website-files.com/6688dd0add61af9d990077eb/66def8f549c69f8ce8ca8210_SEO.jpg" property="twitter:image">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/new-orozco-realty.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Varela:400","Vollkorn:400,400italic,700,700italic","Great Vibes:400","Merriweather:300,300italic,400,400italic,700,700italic,900,900italic","Changa One:400,400italic","Gilda Display:regular","Barlow:200,200italic,300,300italic,regular,italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Barlow Condensed:100,100italic,200,200italic,300,300italic,regular,italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Material Symbols Outlined:100,200,300,regular,500,600,700"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.png" rel="apple-touch-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
  :root{
    --bg:#0f1220; --card:#181b2e; --ink:#e9ecff; --muted:#a8b0d6;
    --accent:#6aa7ff; --accent-2:#8ef3c5; --danger:#ff6b6b;
    --ok:#55d399; --warning:#f9c74f; --chip:#222642;
    --shadow:0 10px 24px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
    --radius:18px;
  }
  html,body{height:100%;}
  body{
    margin:0; background: radial-gradient(1200px 800px at 10% -10%, rgba(106,167,255,0.15), transparent 50%),
                             radial-gradient(900px 700px at 110% 20%, rgba(142,243,197,0.12), transparent 50%),
                             var(--bg);
    color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    -webkit-font-smoothing:antialiased; line-height:1.45;
  }
  .wrap{max-width:1120px; margin:32px auto; padding:0 16px 56px;}
  .header{display:flex; align-items:center; gap:16px; margin-bottom:18px;}
  .logo{width:56px; height:56px; border-radius:14px; display:grid; place-items:center;
    background: linear-gradient(145deg, rgba(106,167,255,0.25), rgba(142,243,197,0.18));
    box-shadow: var(--shadow); font-weight:800; font-size:20px; color:var(--ink);}
  h1{margin:0; font-size:28px; letter-spacing:0.2px;}
  .subtitle{color:var(--muted); margin:6px 0 0; font-size:14px;}
  .grid{display:grid; grid-template-columns:1.1fr 1fr; gap:20px;}
  @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px;}
  .card h2{margin:0 0 12px; font-size:18px;}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
  @media (max-width:700px){ .row{grid-template-columns:1fr;} }
  .field{display:flex; flex-direction:column; gap:8px;}
  .field label{font-size:12px; color:var(--muted);}
  .input, select, button, .slider{border:1px solid rgba(255,255,255,0.06); background:#0f1220; color:var(--ink);
    border-radius:12px; padding:12px 12px; font-size:14px; outline:none;}
  .btn{cursor:pointer; background:linear-gradient(135deg, var(--accent), #7ec8ff); color:#041125; font-weight:800;}
  .btn.secondary{background:linear-gradient(135deg, #7de9bd, var(--accent-2)); color:#0b1a10;}
  .kpi{display:grid; grid-template-columns: repeat(4, 1fr); gap:14px;}
  @media (max-width:820px){ .kpi{grid-template-columns:1fr 1fr;} }
  .kpi .box{background:#0f1220; border:1px solid rgba(255,255,255,0.06); border-radius:16px; padding:14px;}
  .kpi .box small{color:var(--muted)}
  .kpi .box b{display:block; margin-top:6px; font-size:18px;}
  .meter{height:14px; border-radius:999px; background:#0b0f23; border:1px solid rgba(255,255,255,0.06); overflow:hidden;}
  .meter div{height:100%;}
  .legend{display:flex; gap:12px; flex-wrap:wrap;}
  .legend .tag{display:inline-flex; align-items:center; gap:8px; font-size:12px; color:var(--muted)}
  .legend .dot{width:10px; height:10px; border-radius:50%}
  .status{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:#0f1326; border:1px solid rgba(255,255,255,0.06)}
  .status.ok{outline:2px solid rgba(85,211,153,0.25)}
  .status.warn{outline:2px solid rgba(249,199,79,0.25)}
  .status.bad{outline:2px solid rgba(255,107,107,0.25)}
  .note{color:var(--muted); font-size:12px}
  .footer{margin-top:26px; color:var(--muted); font-size:12px; text-align:center}
</style>
</head>
<body>
  <div data-animation="over-left" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-3 navbar-2 w-nav">
    <div class="container-2 navbar-container w-container"></div>
  </div>
  <section class="section">
    <section>
      <section>
        <div class="hp-home-two-counter-sec-inner">
          <div class="w-layout-blockcontainer container_two-2 hp-home-two-counter-sec-container w-container">
            <div class="hp-home-two-counter-content-wrap">
              <div data-w-id="60b51198-2bb3-42f7-839a-b55960d69bcf" style="-webkit-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);opacity:0" class="hp-home-two-counter-title-wrap">
                <div data-w-id="7387878a-dd17-cdbf-bd98-4d236bf569a8" style="opacity:0" class="about-us-title-wrapper">
                  <h1 class="heading-17">RE-Defined</h1>
                  <h6 class="heading-16-copy">See how your dream home may look<br>with &quot;realty-redefined&quot;. </h6>
                </div>
              </div>
              <div class="hp-home-two-counter-details">
                <div class="hp-home-two-counter-item-wrap">
                  <div data-w-id="60b51198-2bb3-42f7-839a-b55960d69bd6" style="opacity:0" class="hp-home-two-counter-item hp-home-two-counter-item-border-left-none">
                    <p class="hp-home-two-counter-title">Paint or Carpet Additions</p>
                    <h3 class="hp-home-two-counter-number">Before &amp; After</h3>
                  </div>
                  <div data-w-id="60b51198-2bb3-42f7-839a-b55960d69bdb" style="opacity:0" class="hp-home-two-counter-item">
                    <p class="hp-home-two-counter-title">Additional Sqft &amp; Areas</p>
                    <h3 class="hp-home-two-counter-number">Home Enhancements</h3>
                  </div>
                </div>
                <div class="hp-home-two-counter-hr"></div>
                <div class="hp-home-two-counter-item-wrap hp-home-two-counter-item-wrap-two">
                  <div data-w-id="60b51198-2bb3-42f7-839a-b55960d69be2" style="opacity:0;-webkit-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(null, 60%, 0) scale3d(0.9, 0.9, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="hp-home-two-counter-item">
                    <p class="hp-home-two-counter-title">Furnished  Rooms</p>
                    <h3 class="hp-home-two-counter-number">Visual Perspective</h3>
                  </div>
                  <div data-w-id="60b51198-2bb3-42f7-839a-b55960d69be7" style="opacity:0" class="hp-home-two-counter-item hp-home-two-counter-item-border-right-none">
                    <p class="hp-home-two-counter-title">Image the Possibilities</p>
                    <h3 class="hp-home-two-counter-number">Just For Fun!</h3>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer class="hp_footer_sect">
          <div class="hp_footer_wrapper-2">
            <div class="container-4">
              <div class="hp_footer_copy_right_box fade-in-top">
                <section class="section-42">
                  <div id="w-node-_0707e586-09cb-1cc7-e216-0b33ac231b2b-4f49e5fc" class="w-layout-layout quick-stack wf-layout-layout">
                    <div class="w-layout-cell cell-2"><img src="../images/Empty-home.jpg" loading="lazy" width="Auto" height="350" alt="" srcset="../images/Empty-home-p-500.jpg 500w, ../images/Empty-home.jpg 770w" sizes="(max-width: 767px) 100vw, 619.53125px" class="image-7">
                      <h6 class="heading-16">Empty Space make it difficult to image what your home will be like. Fortunately now you can simply         RE-Define it!</h6>
                    </div>
                    <div class="w-layout-cell cell">
                      <h6 class="heading-16-copy">Visualize your space before you buy. Discover the joy of seeing your new home before keys in hand.</h6><img src="../images/daa45c77-1d04-462c-bbb6-dfdf6c14fd17.jpg" loading="lazy" width="626" height="400" alt="" srcset="../images/daa45c77-1d04-462c-bbb6-dfdf6c14fd17-p-500.jpg 500w, ../images/daa45c77-1d04-462c-bbb6-dfdf6c14fd17-p-800.jpg 800w, ../images/daa45c77-1d04-462c-bbb6-dfdf6c14fd17-p-1080.jpg 1080w, ../images/daa45c77-1d04-462c-bbb6-dfdf6c14fd17.jpg 1536w" sizes="(max-width: 767px) 100vw, 626px" class="image-3">
                      <h6 class="heading-16">. </h6>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </footer>
      </section>
    </section>
  </section>
  <section class="section-52">
    <div class="hp_analysis_wrapper-2">
      <div class="container-4">
        <div class="hp_analysis_title_box fade-in-top">
          <h2 class="hp_title">Upload your Image and A.I will Generate an Image for you</h2>
        </div>
      </div>
      <div class="hp_faq_items_one hp-home-two-faq-item">
        <section>
          <div class="w-embed w-script"><!--  RE-Defined — Self-contained Virtual Staging Widget (auto-UI + limits)  -->
            <script>
/*//////////////////////////////////////////////////////////////////////////////
// RE-Defined (self-contained)
// - If #safeForm / #safeGo / #safeStatus / #safeResults exist, binds to them.
// - Otherwise, this script builds a complete UI section automatically.
// - Includes spinner, before/after comparison, and usage limits.
// - Temporary client-unlock via ?client=1  (persists in localStorage).
//////////////////////////////////////////////////////////////////////////////*/
(() => {
  /*==========================
    //#0 CONFIG
  ==========================*/
  const API_STAGE = "https://theorozcorealty.netlify.app/api/stage";
  const MAX_FREE = 2; // non-clients can generate 2 images total per browser
  /*==========================
    //#1 UTILITIES
  ==========================*/
  const $ = (s, r = document) => r.querySelector(s);
  const el = (tag, attrs = {}, children = []) => {
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k, v]) => {
      if (k === "style" && typeof v === "object") Object.assign(n.style, v);
      else if (k in n) n[k] = v;
      else n.setAttribute(k, v);
    });
    (Array.isArray(children) ? children : [children]).forEach(c => c && n.appendChild(c));
    return n;
  };
  function ensureClientFlagFromURL() {
    const u = new URL(location.href);
    if (u.searchParams.get("client") === "1") {
      localStorage.setItem("redefined_client", "1");
      u.searchParams.delete("client");
      history.replaceState({}, "", u.toString());
    }
  }
  const isClient = () => localStorage.getItem("redefined_client") === "1";
  const getUsage = () => Number(localStorage.getItem("redefined_usage") || "0");
  const incUsage = () => localStorage.setItem("redefined_usage", String(getUsage() + 1));
  function makeSpinner() {
    const wrap = el("div", { style: {
      display:"grid", placeItems:"center", height:"140px",
      background:"rgba(255,255,255,0.03)", border:"1px solid rgba(255,255,255,0.06)",
      borderRadius:"14px"
    }});
    const sp = el("div", { style: {
      width:"32px", height:"32px", border:"4px solid rgba(255,255,255,0.18)",
      borderTopColor:"#8ef3c5", borderRadius:"50%", animation:"redef-spin .9s linear infinite"
    }});
    wrap.appendChild(sp);
    if (!document.getElementById("redef-spin-style")) {
      document.head.appendChild(el("style", { id:"redef-spin-style", textContent:"@keyframes redef-spin{to{transform:rotate(360deg)}}" }));
    }
    return wrap;
  }
  async function fileToDataURL(file) {
    if (!file) return "";
    if (file.size > 4 * 1024 * 1024) throw new Error("File exceeds 4MB. Upload to Cloudinary/S3 and paste the URL.");
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = () => rej(new Error("Failed to read file"));
      r.readAsDataURL(file);
    });
  }
  function renderBeforeAfter(grid, originalSrc, staged) {
    const first = staged[0];
    if (!first) return;
    const cardStyle = {
      background:"#0e1122", border:"1px solid rgba(255,255,255,0.08)",
      borderRadius:"18px", boxShadow:"0 10px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04)",
      overflow:"hidden"
    };
    const wrap = el("div", { style: {
      display:"grid", gridTemplateColumns:"1fr 1fr", gap:"18px", marginTop:"6px", alignItems:"start"
    }});
    const mkCard = (title, src) => el("div", { style: cardStyle }, [
      el("div", { textContent:title, style:{
        fontSize:"12px", letterSpacing:".16em", textTransform:"uppercase",
        color:"#a8b0d6", padding:"10px 14px"
      }}),
      el("img", { src, alt:title, style:{ width:"100%", display:"block" }})
    ]);
    wrap.appendChild(mkCard("Original", originalSrc));
    wrap.appendChild(mkCard("Staged", first.url));
    const cap = el("div", { style:{
      gridColumn:"1 / -1", display:"flex", justifyContent:"space-between",
      color:"#a8b0d6", fontSize:"12px", marginTop:"6px"
    }}, [
      el("span", { textContent:`${first.width || ""}×${first.height || ""}`}),
      el("span", { textContent:"The Orozco Realty · RE-Defined"})
    ]);
    const section = el("div");
    section.appendChild(wrap);
    section.appendChild(cap);
    grid.appendChild(section);
    if (staged.length > 1) {
      const gal = el("div", { style:{
        display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",
        gap:"12px", marginTop:"14px"
      }});
      staged.slice(1).forEach(x => {
        const a = el("a", { href:x.url, target:"_blank", rel:"noopener",
          style:{ border:"1px solid rgba(255,255,255,0.08)", borderRadius:"14px", overflow:"hidden" }});
        a.appendChild(el("img", { src:x.url, alt:"Variation", style:{ width:"100%" }}));
        gal.appendChild(a);
      });
      grid.appendChild(gal);
    }
  }
  /*==========================
    //#2 ENSURE UI
      - Try to bind to existing markup.
      - If not found, build a full section at the end of <body>.
  ==========================*/
  function ensureUI() {
    let form = $("#safeForm");
    let btn  = $("#safeGo");
    let stat = $("#safeStatus");
    let grid = $("#safeResults");
    if (form && btn && stat && grid) {
      return { form, btn, stat, grid, injected:false };
    }
    // Build injected UI
    const root = el("section", { id:"redefined-safe", style:{
      maxWidth:"1120px", margin:"28px auto", padding:"0 16px", fontFamily:"Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif", color:"#e9ecff"
    }});
    root.appendChild(el("h2", { textContent:"Virtual Staging", style:{ margin:"0 0 12px", fontSize:"28px" }}));
    form = el("form", { id:"safeForm", style:{ display:"grid", gap:"12px", marginBottom:"12px" }}, [
      el("label", {}, [
        el("span", { textContent:"Room Type "}),
        el("select", { name:"room_type" }, [
          el("option", { textContent:"livingroom" }),
          el("option", { textContent:"bedroom" }),
          el("option", { textContent:"kitchen" }),
          el("option", { textContent:"bathroom" }),
          el("option", { textContent:"office" }),
          el("option", { textContent:"diningroom" })
        ])
      ]),
      el("label", {}, [
        el("span", { textContent:"Design Style "}),
        el("select", { name:"design_style" }, [
          el("option", { textContent:"modern" }),
          el("option", { textContent:"minimalist" }),
          el("option", { textContent:"scandinavian" }),
          el("option", { textContent:"luxury" }),
          el("option", { textContent:"farmhouse" }),
          el("option", { textContent:"japandi" }),
          el("option", { textContent:"midcentury" }),
          el("option", { textContent:"industrial" })
        ])
      ]),
      el("div", { style:{ display:"flex", gap:"12px" }}, [
        el("label", { style:{ flex:"1" }}, [
          el("span", { textContent:"Variations "}),
          el("input", { type:"number", name:"num_images", value:"1", min:"1", max:"4" })
        ]),
        el("label", { style:{ flex:"1" }}, [
          el("span", { textContent:"Scale Factor (1–2 recommended) "}),
          el("input", { type:"number", name:"scale_factor", value:"2", min:"1", max:"8" })
        ])
      ]),
      el("details", {}, [
        el("summary", { textContent:"Advanced (optional)" }),
        el("label", {}, [ el("span", { textContent:"Color Scheme "}), el("input", { name:"color_scheme", placeholder:"COLOR_SCHEME_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Specialty Decor "}), el("input", { name:"speciality_decor", placeholder:"SPECIALITY_DECOR_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Extra Prompt "}), el("input", { name:"prompt", placeholder:"e.g., neutral textiles, warm wood" }) ]),
        el("label", {}, [ el("span", { textContent:"Prompt Prefix "}), el("input", { name:"prompt_prefix", placeholder:"(advanced) prefix guidance" }) ])
      ]),
      el("label", {}, [
        el("span", { textContent:"Upload Empty Room (JPG/PNG ≤ 4MB) "}),
        el("input", { type:"file", name:"image", accept:"image/*" })
      ]),
      el("div", { style:{ textAlign:"center" }, textContent:"— or —" }),
      el("label", {}, [
        el("span", { textContent:"Image URL (public) "}),
        el("input", { type:"url", name:"imageUrl", placeholder:"https://..." })
      ]),
      el("div", { style:{ display:"flex", gap:"12px", alignItems:"center" }}, [
        (btn = el("button", { id:"safeGo", type:"submit", textContent:"Generate", style:{
          padding:"10px 14px", borderRadius:"10px", cursor:"pointer",
          background:"linear-gradient(135deg, #6aa7ff, #7ec8ff)", color:"#041125", fontWeight:"800", border:"0"
        }})),
        (stat = el("span", { id:"safeStatus", style:{ marginLeft:"8px", color:"#a8b0d6" }}))
      ])
    ]);
    grid = el("div", { id:"safeResults", style:{
      display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))", gap:"12px"
    }});
    root.appendChild(form);
    root.appendChild(grid);
    document.body.appendChild(root);
    return { form, btn, stat, grid, injected:true };
  }
  /*==========================
    //#3 BOOT + BIND
  ==========================*/
  ensureClientFlagFromURL();
  const ui = ensureUI();
  const { form, btn, stat, grid } = ui;
  const setStatus = (t) => (stat.textContent = t || "");
  const busy = (on) => {
    btn.disabled = !!on;
    btn.dataset.loading = on ? "1" : "";
    btn._label ??= btn.textContent;
    btn.textContent = on ? "Generating…" : btn._label;
  };
  /*==========================
    //#4 SUBMIT HANDLER
  ==========================*/
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const client = isClient();
    if (!client && getUsage() >= MAX_FREE) {
      setStatus("Limit reached — create a free client account to unlock unlimited staging.");
      alert("You've reached the free limit (2). Clients get unlimited. Ask us to enable your client access.");
      return;
    }
    // reset UI
    grid.innerHTML = "";
    const spinner = makeSpinner();
    grid.appendChild(spinner);
    setStatus("Generating…");
    busy(true);
    const fd = new FormData(form);
    const payload = {
      room_type: fd.get("room_type") || "livingroom",
      design_style: fd.get("design_style") || "modern",
      num_images: Number(fd.get("num_images") || 1),
      scale_factor: Number(fd.get("scale_factor") || 2),
      color_scheme: fd.get("color_scheme") || "COLOR_SCHEME_0",
      speciality_decor: fd.get("speciality_decor") || "SPECIALITY_DECOR_0",
      prompt: fd.get("prompt") || "",
      prompt_prefix: fd.get("prompt_prefix") || ""
    };
    let originalSrc = "";
    const file = fd.get("image");
    const url = (fd.get("imageUrl") || "").trim();
    try {
      if (url) {
        payload.input_image_url = url;
        originalSrc = url;
      } else if (file && file.size) {
        const dataUrl = await fileToDataURL(file);
        payload.input_image_url = dataUrl;
        originalSrc = dataUrl;
      } else {
        throw new Error("Please provide an image file or a public image URL.");
      }
      const r = await fetch(API_STAGE, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const j = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(j?.error || `Proxy error ${r.status}`);
      const imgs = j?.info?.images || [];
      if (!imgs.length) {
        setStatus("No images returned.");
        spinner.remove();
        busy(false);
        return;
      }
      spinner.remove();
      renderBeforeAfter(grid, originalSrc, imgs);
      setStatus("Done ✅");
      if (!client) incUsage();
    } catch (err) {
      console.error("[RE-Defined] Error", err);
      spinner.remove();
      setStatus("Error: " + (err?.message || err));
      alert("Generation failed: " + (err?.message || err));
    } finally {
      busy(false);
    }
  });
})(); // end IIFE
</script>
          </div>
        </section>
      </div>
    </div>
    <section>
      <div class="hp_footer_wrapper-2">
        <div class="container-4"></div>
        <div id="w-node-_8f209115-3f9d-75f7-2a46-9962d5192aff-4f49e5fc" class="w-layout-layout quick-stack-2 wf-layout-layout">
          <div class="w-layout-cell"><img src="../images/Elenafullbody.png" loading="lazy" width="291" height="400" alt="" srcset="../images/Elenafullbody-p-500.png 500w, ../images/Elenafullbody-p-800.png 800w, ../images/Elenafullbody-p-1080.png 1080w, ../images/Elenafullbody.png 1284w" sizes="(max-width: 479px) 100vw, 291px" class="image-8"></div>
          <div class="w-layout-cell cell-3">
            <div class="w-embed w-script"><!--  RE-Defined — Self-contained Virtual Staging Widget (auto-UI + limits)  -->
              <script>
/*//////////////////////////////////////////////////////////////////////////////
// RE-Defined (self-contained)
// - If #safeForm / #safeGo / #safeStatus / #safeResults exist, binds to them.
// - Otherwise, this script builds a complete UI section automatically.
// - Includes spinner, before/after comparison, and usage limits.
// - Temporary client-unlock via ?client=1  (persists in localStorage).
//////////////////////////////////////////////////////////////////////////////*/
(() => {
  /*==========================
    //#0 CONFIG
  ==========================*/
  const API_STAGE = "https://theorozcorealty.netlify.app/api/stage";
  const MAX_FREE = 2; // non-clients can generate 2 images total per browser
  /*==========================
    //#1 UTILITIES
  ==========================*/
  const $ = (s, r = document) => r.querySelector(s);
  const el = (tag, attrs = {}, children = []) => {
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k, v]) => {
      if (k === "style" && typeof v === "object") Object.assign(n.style, v);
      else if (k in n) n[k] = v;
      else n.setAttribute(k, v);
    });
    (Array.isArray(children) ? children : [children]).forEach(c => c && n.appendChild(c));
    return n;
  };
  function ensureClientFlagFromURL() {
    const u = new URL(location.href);
    if (u.searchParams.get("client") === "1") {
      localStorage.setItem("redefined_client", "1");
      u.searchParams.delete("client");
      history.replaceState({}, "", u.toString());
    }
  }
  const isClient = () => localStorage.getItem("redefined_client") === "1";
  const getUsage = () => Number(localStorage.getItem("redefined_usage") || "0");
  const incUsage = () => localStorage.setItem("redefined_usage", String(getUsage() + 1));
  function makeSpinner() {
    const wrap = el("div", { style: {
      display:"grid", placeItems:"center", height:"140px",
      background:"rgba(255,255,255,0.03)", border:"1px solid rgba(255,255,255,0.06)",
      borderRadius:"14px"
    }});
    const sp = el("div", { style: {
      width:"32px", height:"32px", border:"4px solid rgba(255,255,255,0.18)",
      borderTopColor:"#8ef3c5", borderRadius:"50%", animation:"redef-spin .9s linear infinite"
    }});
    wrap.appendChild(sp);
    if (!document.getElementById("redef-spin-style")) {
      document.head.appendChild(el("style", { id:"redef-spin-style", textContent:"@keyframes redef-spin{to{transform:rotate(360deg)}}" }));
    }
    return wrap;
  }
  async function fileToDataURL(file) {
    if (!file) return "";
    if (file.size > 4 * 1024 * 1024) throw new Error("File exceeds 4MB. Upload to Cloudinary/S3 and paste the URL.");
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = () => rej(new Error("Failed to read file"));
      r.readAsDataURL(file);
    });
  }
  function renderBeforeAfter(grid, originalSrc, staged) {
    const first = staged[0];
    if (!first) return;
    const cardStyle = {
      background:"#0e1122", border:"1px solid rgba(255,255,255,0.08)",
      borderRadius:"18px", boxShadow:"0 10px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04)",
      overflow:"hidden"
    };
    const wrap = el("div", { style: {
      display:"grid", gridTemplateColumns:"1fr 1fr", gap:"18px", marginTop:"6px", alignItems:"start"
    }});
    const mkCard = (title, src) => el("div", { style: cardStyle }, [
      el("div", { textContent:title, style:{
        fontSize:"12px", letterSpacing:".16em", textTransform:"uppercase",
        color:"#a8b0d6", padding:"10px 14px"
      }}),
      el("img", { src, alt:title, style:{ width:"100%", display:"block" }})
    ]);
    wrap.appendChild(mkCard("Original", originalSrc));
    wrap.appendChild(mkCard("Staged", first.url));
    const cap = el("div", { style:{
      gridColumn:"1 / -1", display:"flex", justifyContent:"space-between",
      color:"#a8b0d6", fontSize:"12px", marginTop:"6px"
    }}, [
      el("span", { textContent:`${first.width || ""}×${first.height || ""}`}),
      el("span", { textContent:"The Orozco Realty · RE-Defined"})
    ]);
    const section = el("div");
    section.appendChild(wrap);
    section.appendChild(cap);
    grid.appendChild(section);
    if (staged.length > 1) {
      const gal = el("div", { style:{
        display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",
        gap:"12px", marginTop:"14px"
      }});
      staged.slice(1).forEach(x => {
        const a = el("a", { href:x.url, target:"_blank", rel:"noopener",
          style:{ border:"1px solid rgba(255,255,255,0.08)", borderRadius:"14px", overflow:"hidden" }});
        a.appendChild(el("img", { src:x.url, alt:"Variation", style:{ width:"100%" }}));
        gal.appendChild(a);
      });
      grid.appendChild(gal);
    }
  }
  /*==========================
    //#2 ENSURE UI
      - Try to bind to existing markup.
      - If not found, build a full section at the end of <body>.
  ==========================*/
  function ensureUI() {
    let form = $("#safeForm");
    let btn  = $("#safeGo");
    let stat = $("#safeStatus");
    let grid = $("#safeResults");
    if (form && btn && stat && grid) {
      return { form, btn, stat, grid, injected:false };
    }
    // Build injected UI
    const root = el("section", { id:"redefined-safe", style:{
      maxWidth:"1120px", margin:"28px auto", padding:"0 16px", fontFamily:"Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif", color:"#e9ecff"
    }});
    root.appendChild(el("h2", { textContent:"Virtual Staging", style:{ margin:"0 0 12px", fontSize:"28px" }}));
    form = el("form", { id:"safeForm", style:{ display:"grid", gap:"12px", marginBottom:"12px" }}, [
      el("label", {}, [
        el("span", { textContent:"Room Type "}),
        el("select", { name:"room_type" }, [
          el("option", { textContent:"livingroom" }),
          el("option", { textContent:"bedroom" }),
          el("option", { textContent:"kitchen" }),
          el("option", { textContent:"bathroom" }),
          el("option", { textContent:"office" }),
          el("option", { textContent:"diningroom" })
        ])
      ]),
      el("label", {}, [
        el("span", { textContent:"Design Style "}),
        el("select", { name:"design_style" }, [
          el("option", { textContent:"modern" }),
          el("option", { textContent:"minimalist" }),
          el("option", { textContent:"scandinavian" }),
          el("option", { textContent:"luxury" }),
          el("option", { textContent:"farmhouse" }),
          el("option", { textContent:"japandi" }),
          el("option", { textContent:"midcentury" }),
          el("option", { textContent:"industrial" })
        ])
      ]),
      el("div", { style:{ display:"flex", gap:"12px" }}, [
        el("label", { style:{ flex:"1" }}, [
          el("span", { textContent:"Variations "}),
          el("input", { type:"number", name:"num_images", value:"1", min:"1", max:"4" })
        ]),
        el("label", { style:{ flex:"1" }}, [
          el("span", { textContent:"Scale Factor (1–2 recommended) "}),
          el("input", { type:"number", name:"scale_factor", value:"2", min:"1", max:"8" })
        ])
      ]),
      el("details", {}, [
        el("summary", { textContent:"Advanced (optional)" }),
        el("label", {}, [ el("span", { textContent:"Color Scheme "}), el("input", { name:"color_scheme", placeholder:"COLOR_SCHEME_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Specialty Decor "}), el("input", { name:"speciality_decor", placeholder:"SPECIALITY_DECOR_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Extra Prompt "}), el("input", { name:"prompt", placeholder:"e.g., neutral textiles, warm wood" }) ]),
        el("label", {}, [ el("span", { textContent:"Prompt Prefix "}), el("input", { name:"prompt_prefix", placeholder:"(advanced) prefix guidance" }) ])
      ]),
      el("label", {}, [
        el("span", { textContent:"Upload Empty Room (JPG/PNG ≤ 4MB) "}),
        el("input", { type:"file", name:"image", accept:"image/*" })
      ]),
      el("div", { style:{ textAlign:"center" }, textContent:"— or —" }),
      el("label", {}, [
        el("span", { textContent:"Image URL (public) "}),
        el("input", { type:"url", name:"imageUrl", placeholder:"https://..." })
      ]),
      el("div", { style:{ display:"flex", gap:"12px", alignItems:"center" }}, [
        (btn = el("button", { id:"safeGo", type:"submit", textContent:"Generate", style:{
          padding:"10px 14px", borderRadius:"10px", cursor:"pointer",
          background:"linear-gradient(135deg, #6aa7ff, #7ec8ff)", color:"#041125", fontWeight:"800", border:"0"
        }})),
        (stat = el("span", { id:"safeStatus", style:{ marginLeft:"8px", color:"#a8b0d6" }}))
      ])
    ]);
    grid = el("div", { id:"safeResults", style:{
      display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))", gap:"12px"
    }});
    root.appendChild(form);
    root.appendChild(grid);
    document.body.appendChild(root);
    return { form, btn, stat, grid, injected:true };
  }
  /*==========================
    //#3 BOOT + BIND
  ==========================*/
  ensureClientFlagFromURL();
  const ui = ensureUI();
  const { form, btn, stat, grid } = ui;
  const setStatus = (t) => (stat.textContent = t || "");
  const busy = (on) => {
    btn.disabled = !!on;
    btn.dataset.loading = on ? "1" : "";
    btn._label ??= btn.textContent;
    btn.textContent = on ? "Generating…" : btn._label;
  };
  /*==========================
    //#4 SUBMIT HANDLER
  ==========================*/
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const client = isClient();
    if (!client && getUsage() >= MAX_FREE) {
      setStatus("Limit reached — create a free client account to unlock unlimited staging.");
      alert("You've reached the free limit (2). Clients get unlimited. Ask us to enable your client access.");
      return;
    }
    // reset UI
    grid.innerHTML = "";
    const spinner = makeSpinner();
    grid.appendChild(spinner);
    setStatus("Generating…");
    busy(true);
    const fd = new FormData(form);
    const payload = {
      room_type: fd.get("room_type") || "livingroom",
      design_style: fd.get("design_style") || "modern",
      num_images: Number(fd.get("num_images") || 1),
      scale_factor: Number(fd.get("scale_factor") || 2),
      color_scheme: fd.get("color_scheme") || "COLOR_SCHEME_0",
      speciality_decor: fd.get("speciality_decor") || "SPECIALITY_DECOR_0",
      prompt: fd.get("prompt") || "",
      prompt_prefix: fd.get("prompt_prefix") || ""
    };
    let originalSrc = "";
    const file = fd.get("image");
    const url = (fd.get("imageUrl") || "").trim();
    try {
      if (url) {
        payload.input_image_url = url;
        originalSrc = url;
      } else if (file && file.size) {
        const dataUrl = await fileToDataURL(file);
        payload.input_image_url = dataUrl;
        originalSrc = dataUrl;
      } else {
        throw new Error("Please provide an image file or a public image URL.");
      }
      const r = await fetch(API_STAGE, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const j = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(j?.error || `Proxy error ${r.status}`);
      const imgs = j?.info?.images || [];
      if (!imgs.length) {
        setStatus("No images returned.");
        spinner.remove();
        busy(false);
        return;
      }
      spinner.remove();
      renderBeforeAfter(grid, originalSrc, imgs);
      setStatus("Done ✅");
      if (!client) incUsage();
    } catch (err) {
      console.error("[RE-Defined] Error", err);
      spinner.remove();
      setStatus("Error: " + (err?.message || err));
      alert("Generation failed: " + (err?.message || err));
    } finally {
      busy(false);
    }
  });
})(); // end IIFE
</script>
            </div>
          </div>
        </div>
      </div>
      <section>
        <div class="w-embed w-script"><!--  Flip.ai — Self-contained Deal Analyzer + Staging Preview (auto-UI + limits)  -->
          <script>
/*//////////////////////////////////////////////////////////////////////////////
// Flip.ai (self-contained)
// - Auto-binds to #flipForm / #flipGo / #flipStatus / #flipResults if present,
//   else builds a complete UI section automatically.
// - Features:
//    • ROI calculator (Purchase, Rehab, ARV, Holding, Loan terms, Exit strategy)
//    • Before/After image preview (calls staging if provided)
//    • CSV export of results
//    • Usage limits: non-clients get 2 generations total; clients unlimited
//    • Temporary client unlock via ?client=1 persisted in localStorage
//////////////////////////////////////////////////////////////////////////////*/
(() => {
  /*==========================
    //#0 CONFIG
  ==========================*/
  // TODO: point these to your live Netlify/Render endpoints when ready:
  const API_ANALYZE = "https://theorozcorealty.netlify.app/api/flip/analyze"; // returns analytics (optional)
  const API_STAGE   = "https://theorozcorealty.netlify.app/api/stage";        // returns {info:{images:[{url,width,height},...]}}
  const MAX_FREE = 2; // non-clients can run 2 analyses/generations total per browser
  /*==========================
    //#1 UTILITIES
  ==========================*/
  const $ = (s, r = document) => r.querySelector(s);
  const el = (tag, attrs = {}, children = []) => {
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k, v]) => {
      if (k === "style" && typeof v === "object") Object.assign(n.style, v);
      else if (k in n) n[k] = v;
      else n.setAttribute(k, v);
    });
    (Array.isArray(children) ? children : [children]).forEach(c => c && n.appendChild(c));
    return n;
  };
  function ensureClientFlagFromURL() {
    const u = new URL(location.href);
    if (u.searchParams.get("client") === "1") {
      localStorage.setItem("redefined_client", "1");
      u.searchParams.delete("client");
      history.replaceState({}, "", u.toString());
    }
  }
  const isClient = () => localStorage.getItem("redefined_client") === "1";
  const getUsage = () => Number(localStorage.getItem("flip_usage") || "0");
  const incUsage = () => localStorage.setItem("flip_usage", String(getUsage() + 1));
  function makeSpinner() {
    const wrap = el("div", { style: {
      display:"grid", placeItems:"center", height:"140px",
      background:"rgba(255,255,255,0.03)", border:"1px solid rgba(255,255,255,0.06)",
      borderRadius:"14px"
    }});
    const sp = el("div", { style: {
      width:"32px", height:"32px", border:"4px solid rgba(255,255,255,0.18)",
      borderTopColor:"#8ef3c5", borderRadius:"50%", animation:"flip-spin .9s linear infinite"
    }});
    wrap.appendChild(sp);
    if (!document.getElementById("flip-spin-style")) {
      document.head.appendChild(el("style", { id:"flip-spin-style", textContent:"@keyframes flip-spin{to{transform:rotate(360deg)}}" }));
    }
    return wrap;
  }
  async function fileToDataURL(file) {
    if (!file) return "";
    if (file.size > 4 * 1024 * 1024) throw new Error("File exceeds 4MB. Upload to Cloudinary/S3 and paste the URL.");
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = () => rej(new Error("Failed to read file"));
      r.readAsDataURL(file);
    });
  }
  function money(n) {
    if (!isFinite(n)) return "-";
    return n.toLocaleString(undefined, { style:"currency", currency:"USD", maximumFractionDigits:0 });
  }
  function percent(n) {
    if (!isFinite(n)) return "-";
    return (n).toLocaleString(undefined, { maximumFractionDigits:1 }) + "%";
  }
  function csvDownload(name, rows) {
    const csv = rows.map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
    const blob = new Blob([csv], { type:"text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = el("a", { href:url, download:name });
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }
  function renderBeforeAfter(grid, originalSrc, staged) {
    const first = staged?.[0];
    if (!first) return;
    const cardStyle = {
      background:"#0e1122", border:"1px solid rgba(255,255,255,0.08)",
      borderRadius:"18px", boxShadow:"0 10px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04)",
      overflow:"hidden"
    };
    const wrap = el("div", { style: {
      display:"grid", gridTemplateColumns:"1fr 1fr", gap:"18px", marginTop:"6px", alignItems:"start"
    }});
    const mkCard = (title, src) => el("div", { style: cardStyle }, [
      el("div", { textContent:title, style:{
        fontSize:"12px", letterSpacing:".16em", textTransform:"uppercase",
        color:"#a8b0d6", padding:"10px 14px"
      }}),
      el("img", { src, alt:title, style:{ width:"100%", display:"block" }})
    ]);
    wrap.appendChild(mkCard("Original", originalSrc));
    wrap.appendChild(mkCard("Staged", first.url));
    const cap = el("div", { style:{
      gridColumn:"1 / -1", display:"flex", justifyContent:"space-between",
      color:"#a8b0d6", fontSize:"12px", marginTop:"6px"
    }}, [
      el("span", { textContent:`${first.width || ""}×${first.height || ""}`}),
      el("span", { textContent:"The Orozco Realty · Flip.ai"})
    ]);
    const section = el("div");
    section.appendChild(wrap);
    section.appendChild(cap);
    grid.appendChild(section);
    if (staged.length > 1) {
      const gal = el("div", { style:{
        display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",
        gap:"12px", marginTop:"14px"
      }});
      staged.slice(1).forEach(x => {
        const a = el("a", { href:x.url, target:"_blank", rel:"noopener",
          style:{ border:"1px solid rgba(255,255,255,0.08)", borderRadius:"14px", overflow:"hidden" }});
        a.appendChild(el("img", { src:x.url, alt:"Variation", style:{ width:"100%" }}));
        gal.appendChild(a);
      });
      grid.appendChild(gal);
    }
  }
  function renderMetrics(grid, M) {
    const card = el("div", { style:{
      background:"#0e1122", border:"1px solid rgba(255,255,255,0.08)",
      borderRadius:"18px", padding:"14px", boxShadow:"0 10px 24px rgba(0,0,0,.35)", overflow:"hidden"
    }});
    const title = el("div", { textContent:"Flip.ai — Deal Metrics", style:{
      fontSize:"12px", letterSpacing:".16em", textTransform:"uppercase",
      color:"#a8b0d6", marginBottom:"10px"
    }});
    const grid2 = el("div", { style:{
      display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))", gap:"10px"
    }});
    const Row = (k, v) => el("div", { style:{
      background:"rgba(255,255,255,0.03)", border:"1px solid rgba(255,255,255,0.06)",
      borderRadius:"12px", padding:"10px"
    }}, [
      el("div", { textContent:k, style:{ fontSize:"11px", color:"#a8b0d6", marginBottom:"6px" } }),
      el("div", { textContent:v, style:{ fontWeight:"800" } })
    ]);
    grid2.append(
      Row("Purchase Price", money(M.purchase)),
      Row("Rehab Cost", money(M.rehab)),
      Row("Holding Months", String(M.holdMonths)),
      Row("Total Basis", money(M.basis)),
      Row("ARV", money(M.arv)),
      Row("Sell Cost (%. broker+closing)", money(M.sellCost)),
      Row("Loan Amount", money(M.loanAmount)),
      Row("Interest (total)", money(M.totalInterest)),
      Row("Monthly Payment (est.)", money(M.monthlyPmt)),
      Row("Gross Profit", money(M.grossProfit)),
      Row("Net Profit", money(M.netProfit)),
      Row("Net Margin", percent(M.netMarginPct)),
      Row("Annualized ROI", percent(M.annualizedRoiPct))
    );
    const btns = el("div", { style:{ marginTop:"12px", display:"flex", gap:"8px", flexWrap:"wrap" }});
    const csvBtn = el("button", { type:"button", textContent:"Download CSV", style:{
      padding:"8px 12px", borderRadius:"10px", cursor:"pointer",
      background:"linear-gradient(135deg, #6aa7ff, #7ec8ff)", color:"#041125", fontWeight:"800", border:"0"
    }});
    csvBtn.addEventListener("click", () => {
      csvDownload("flip_deal.csv", [
        ["Metric","Value"],
        ["Purchase Price", M.purchase],
        ["Rehab Cost", M.rehab],
        ["Holding Months", M.holdMonths],
        ["Total Basis", M.basis],
        ["ARV", M.arv],
        ["Sell Cost", M.sellCost],
        ["Loan Amount", M.loanAmount],
        ["Interest (total)", M.totalInterest],
        ["Monthly Payment (est.)", M.monthlyPmt],
        ["Gross Profit", M.grossProfit],
        ["Net Profit", M.netProfit],
        ["Net Margin %", M.netMarginPct],
        ["Annualized ROI %", M.annualizedRoiPct]
      ]);
    });
    btns.append(csvBtn);
    card.append(title, grid2, btns);
    grid.appendChild(card);
  }
  // Core finance helpers (simple, transparent, client-side)
  function computeMetrics(d) {
    const p = Number(d.purchase || 0);
    const r = Number(d.rehab || 0);
    const arv = Number(d.arv || 0);
    const holdMonths = Number(d.holdMonths || 6);
    const sellPct = Math.max(0, Number(d.sellPct || 0.08)); // 8% default broker+closing
    const ltv = Math.min(0.95, Math.max(0, Number(d.ltv || 0.8))); // 80% default
    const apr = Math.max(0, Number(d.apr || 0.10)); // 10% default APR
    const pointsPct = Math.max(0, Number(d.pointsPct || 0.02)); // 2 points default (on loan)
    const taxesInsPerMonth = Math.max(0, Number(d.taxesInsPerMonth || 300)); // carrying
    const basis = p + r;
    const sellCost = arv * sellPct;
    const loanAmount = Math.min(basis, Math.max(0, basis * ltv));
    const monthlyRate = apr / 12;
    const monthlyPmt = loanAmount * monthlyRate; // interest-only assumption
    const totalInterest = monthlyPmt * holdMonths + (loanAmount * pointsPct);
    const grossProfit = arv - sellCost - basis;
    const netProfit = grossProfit - totalInterest - taxesInsPerMonth * holdMonths;
    const netMarginPct = (netProfit / basis) * 100;
    const annualizedRoiPct = (netProfit / basis) * (12 / Math.max(1, holdMonths)) * 100;
    return {
      purchase:p, rehab:r, arv, holdMonths, sellCost,
      ltv, apr, pointsPct, taxesInsPerMonth,
      loanAmount, monthlyRate, monthlyPmt, totalInterest,
      basis, grossProfit, netProfit, netMarginPct, annualizedRoiPct
    };
  }
  /*==========================
    //#2 ENSURE UI
  ==========================*/
  function ensureUI() {
    let form = $("#flipForm");
    let btn  = $("#flipGo");
    let stat = $("#flipStatus");
    let grid = $("#flipResults");
    if (form && btn && stat && grid) {
      return { form, btn, stat, grid, injected:false };
    }
    // Build injected UI
    const root = el("section", { id:"flip-safe", style:{
      maxWidth:"1120px", margin:"28px auto", padding:"0 16px", fontFamily:"Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif", color:"#e9ecff"
    }});
    root.appendChild(el("h2", { textContent:"Flip.ai — Deal Analyzer", style:{ margin:"0 0 12px", fontSize:"28px" }}));
    form = el("form", { id:"flipForm", style:{ display:"grid", gap:"12px", marginBottom:"12px" }}, [
      // Row A — Deal Basics
      el("div", { style:{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))", gap:"12px" }}, [
        el("label", {}, [ el("span", { textContent:"Purchase Price" }), el("input", { name:"purchase", type:"number", placeholder:"250000" }) ]),
        el("label", {}, [ el("span", { textContent:"Rehab Cost" }), el("input", { name:"rehab", type:"number", placeholder:"60000" }) ]),
        el("label", {}, [ el("span", { textContent:"ARV" }), el("input", { name:"arv", type:"number", placeholder:"380000" }) ]),
        el("label", {}, [ el("span", { textContent:"Holding Months" }), el("input", { name:"holdMonths", type:"number", value:"6", min:"1", max:"24" }) ])
      ]),
      // Row B — Financing
      el("details", { open:false, style:{ border:"1px solid rgba(255,255,255,0.08)", borderRadius:"12px", padding:"10px" }}, [
        el("summary", { textContent:"Financing (optional)" }),
        el("div", { style:{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))", gap:"12px", marginTop:"10px" }}, [
          el("label", {}, [ el("span", { textContent:"LTV (0–1)" }), el("input", { name:"ltv", type:"number", step:"0.01", value:"0.8", min:"0", max:"0.95" }) ]),
          el("label", {}, [ el("span", { textContent:"APR (0–1)" }), el("input", { name:"apr", type:"number", step:"0.001", value:"0.10", min:"0", max:"0.5" }) ]),
          el("label", {}, [ el("span", { textContent:"Points (0–1)" }), el("input", { name:"pointsPct", type:"number", step:"0.001", value:"0.02", min:"0", max:"0.1" }) ]),
          el("label", {}, [ el("span", { textContent:"Taxes+Insurance ($/mo)" }), el("input", { name:"taxesInsPerMonth", type:"number", step:"1", value:"300", min:"0" }) ]),
          el("label", {}, [ el("span", { textContent:"Sell Cost % (0–1)" }), el("input", { name:"sellPct", type:"number", step:"0.001", value:"0.08", min:"0", max:"0.2" }) ]),
        ])
      ]),
      // Row C — Exit & Style (for staging)
      el("div", { style:{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))", gap:"12px" }}, [
        el("label", {}, [ el("span", { textContent:"Exit Strategy" }),
          el("select", { name:"exitStrategy" }, [
            el("option", { textContent:"Flip" }),
            el("option", { textContent:"BRRRR" }),
            el("option", { textContent:"Rent" })
          ])
        ]),
        el("label", {}, [ el("span", { textContent:"Room Type" }),
          el("select", { name:"room_type" }, [
            el("option", { textContent:"livingroom" }),
            el("option", { textContent:"bedroom" }),
            el("option", { textContent:"kitchen" }),
            el("option", { textContent:"bathroom" }),
            el("option", { textContent:"office" }),
            el("option", { textContent:"diningroom" })
          ])
        ]),
        el("label", {}, [ el("span", { textContent:"Design Style" }),
          el("select", { name:"design_style" }, [
            el("option", { textContent:"modern" }),
            el("option", { textContent:"minimalist" }),
            el("option", { textContent:"scandinavian" }),
            el("option", { textContent:"luxury" }),
            el("option", { textContent:"farmhouse" }),
            el("option", { textContent:"japandi" }),
            el("option", { textContent:"midcentury" }),
            el("option", { textContent:"industrial" })
          ])
        ])
      ]),
      // Row D — Image input (optional)
      el("div", { style:{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))", gap:"12px" }}, [
        el("label", {}, [ el("span", { textContent:"Upload Photo (≤ 4MB)" }), el("input", { type:"file", name:"image", accept:"image/*" }) ]),
        el("label", {}, [ el("span", { textContent:"OR Image URL (public)" }), el("input", { name:"imageUrl", type:"url", placeholder:"https://..." }) ]),
        el("label", {}, [ el("span", { textContent:"Variations (1–4)" }), el("input", { name:"num_images", type:"number", value:"1", min:"1", max:"4" }) ]),
        el("label", {}, [ el("span", { textContent:"Scale Factor (1–2 rec.)" }), el("input", { name:"scale_factor", type:"number", value:"2", min:"1", max:"8" }) ])
      ]),
      // Row E — Advanced prompt
      el("details", {}, [
        el("summary", { textContent:"Advanced Staging (optional)" }),
        el("label", {}, [ el("span", { textContent:"Color Scheme "}), el("input", { name:"color_scheme", placeholder:"COLOR_SCHEME_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Specialty Decor "}), el("input", { name:"speciality_decor", placeholder:"SPECIALITY_DECOR_0" }) ]),
        el("label", {}, [ el("span", { textContent:"Extra Prompt "}), el("input", { name:"prompt", placeholder:"e.g., neutral textiles, warm wood" }) ]),
        el("label", {}, [ el("span", { textContent:"Prompt Prefix "}), el("input", { name:"prompt_prefix", placeholder:"(advanced) prefix guidance" }) ])
      ]),
      // CTA
      el("div", { style:{ display:"flex", gap:"12px", alignItems:"center" }}, [
        (btn = el("button", { id:"flipGo", type:"submit", textContent:"Analyze Deal", style:{
          padding:"10px 14px", borderRadius:"10px", cursor:"pointer",
          background:"linear-gradient(135deg, #6aa7ff, #7ec8ff)", color:"#041125", fontWeight:"800", border:"0"
        }})),
        (stat = el("span", { id:"flipStatus", style:{ marginLeft:"8px", color:"#a8b0d6" }}))
      ])
    ]);
    grid = el("div", { id:"flipResults", style:{
      display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))", gap:"12px"
    }});
    root.appendChild(form);
    root.appendChild(grid);
    document.body.appendChild(root);
    return { form, btn, stat, grid, injected:true };
  }
  /*==========================
    //#3 BOOT + BIND
  ==========================*/
  ensureClientFlagFromURL();
  const ui = ensureUI();
  const { form, btn, stat, grid } = ui;
  const setStatus = (t) => (stat.textContent = t || "");
  const busy = (on) => {
    btn.disabled = !!on;
    btn.dataset.loading = on ? "1" : "";
    btn._label ??= btn.textContent;
    btn.textContent = on ? "Working…" : btn._label;
  };
  /*==========================
    //#4 SUBMIT HANDLER
  ==========================*/
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const client = isClient();
    if (!client && getUsage() >= MAX_FREE) {
      setStatus("Limit reached — create a free client account to unlock unlimited analyses.");
      alert("You've reached the free limit (2). Clients get unlimited. Ask us to enable your client access.");
      return;
    }
    // reset UI
    grid.innerHTML = "";
    const spinner = makeSpinner();
    grid.appendChild(spinner);
    setStatus("Crunching the numbers…");
    busy(true);
    const fd = new FormData(form);
    // Collect analytics payload
    const payload = {
      purchase: Number(fd.get("purchase") || 0),
      rehab: Number(fd.get("rehab") || 0),
      arv: Number(fd.get("arv") || 0),
      holdMonths: Number(fd.get("holdMonths") || 6),
      ltv: Number(fd.get("ltv") || 0.8),
      apr: Number(fd.get("apr") || 0.10),
      pointsPct: Number(fd.get("pointsPct") || 0.02),
      taxesInsPerMonth: Number(fd.get("taxesInsPerMonth") || 300),
      sellPct: Number(fd.get("sellPct") || 0.08),
      exitStrategy: String(fd.get("exitStrategy") || "Flip")
    };
    // Image inputs
    let originalSrc = "";
    const file = fd.get("image");
    const url = (fd.get("imageUrl") || "").trim();
    // Staging payload (optional)
    const stageReq = {
      room_type: fd.get("room_type") || "livingroom",
      design_style: fd.get("design_style") || "modern",
      num_images: Number(fd.get("num_images") || 1),
      scale_factor: Number(fd.get("scale_factor") || 2),
      color_scheme: fd.get("color_scheme") || "COLOR_SCHEME_0",
      speciality_decor: fd.get("speciality_decor") || "SPECIALITY_DECOR_0",
      prompt: fd.get("prompt") || "",
      prompt_prefix: fd.get("prompt_prefix") || ""
    };
    try {
      // 1) Compute metrics client-side instantly (fast UX)
      const metrics = computeMetrics(payload);
      // 2) Optionally call your backend for logging/comps/AI add-ons
      //    Non-blocking: we won't fail UX if this endpoint is not set up yet.
      try {
        fetch(API_ANALYZE, {
          method:"POST",
          headers:{ "Content-Type": "application/json" },
          body: JSON.stringify({ payload, metrics })
        }).catch(()=>{});
      } catch(_) {}
      // 3) If image provided, call staging
      let stagedImages = [];
      if (url) {
        stageReq.input_image_url = url;
        originalSrc = url;
      } else if (file && file.size) {
        const dataUrl = await fileToDataURL(file);
        stageReq.input_image_url = dataUrl;
        originalSrc = dataUrl;
      }
      spinner.remove();
      // Render metrics first (always)
      renderMetrics(grid, metrics);
      setStatus("Metrics ready ✅");
      // If we have an image input, try staging (and count usage if non-client)
      if (stageReq.input_image_url) {
        const stageSpinner = makeSpinner();
        grid.appendChild(stageSpinner);
        setStatus("Generating virtual staging…");
        // Enforce image variation limits for non-clients
        if (!client) {
          stageReq.num_images = Math.min(stageReq.num_images || 1, 2); // cap to 2
        }
        try {
          const r = await fetch(API_STAGE, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(stageReq)
          });
          const j = await r.json().catch(() => ({}));
          if (!r.ok) throw new Error(j?.error || `Staging proxy error ${r.status}`);
          stagedImages = j?.info?.images || [];
          stageSpinner.remove();
          if (stagedImages.length) {
            renderBeforeAfter(grid, originalSrc, stagedImages);
            setStatus("Analysis + Staging complete ✅");
          } else {
            setStatus("Analysis complete — no images returned.");
          }
        } catch (err) {
          console.error("[Flip.ai] Staging Error", err);
          stageSpinner.remove();
          setStatus("Analysis complete. Staging failed: " + (err?.message || err));
          alert("Staging failed: " + (err?.message || err));
        }
      }
      if (!client) incUsage();
    } catch (err) {
      console.error("[Flip.ai] Error", err);
      spinner.remove();
      setStatus("Error: " + (err?.message || err));
      alert("Deal analysis failed: " + (err?.message || err));
    } finally {
      busy(false);
    }
  });
})(); // end IIFE
</script>
        </div>
      </section>
    </section>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=68ab0c767e65bfdde9efba3b" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../js/webflow.js" type="text/javascript"></script><!--  RE-Defined: Virtual Staging (Netlify Integration)  -->
  <script>
(() => {
  // 1) Your new Netlify function endpoint
  const API_STAGE = "https://theorozcorealty.netlify.app/api/stage";
  // 2) Shortcuts
  const $ = s => document.querySelector(s);
  const form = $("#safeForm"), btn = $("#safeGo"), stat = $("#safeStatus"), grid = $("#safeResults");
  const setStatus = t => stat.textContent = t || "";
  // 3) Convert uploaded file → Base64 Data URL
  async function fileToDataURL(file) {
    if (!file) return "";
    if (file.size > 4 * 1024 * 1024) throw new Error("File exceeds 4MB. Upload to Cloudinary/S3 instead.");
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = () => rej(new Error("Failed to read file"));
      r.readAsDataURL(file);
    });
  }
  // 4) Form submit handler
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    setStatus("Generating…");
    btn.disabled = true;
    grid.innerHTML = "";
    const fd = new FormData(form);
    const payload = {
      room_type: fd.get("room_type") || "livingroom",
      design_style: fd.get("design_style") || "modern",
      num_images: Number(fd.get("num_images") || 1),
      scale_factor: Number(fd.get("scale_factor") || 2),
      color_scheme: fd.get("color_scheme") || "COLOR_SCHEME_0",
      speciality_decor: fd.get("speciality_decor") || "SPECIALITY_DECOR_0",
      prompt: fd.get("prompt") || "",
      prompt_prefix: fd.get("prompt_prefix") || ""
    };
    const file = fd.get("image");
    const url = (fd.get("imageUrl") || "").trim();
    try {
      // Pick image source: URL first, then file
      if (url) {
        payload.input_image_url = url;
      } else if (file && file.size) {
        payload.input_image_url = await fileToDataURL(file);
      } else {
        throw new Error("Please provide an image file or a public image URL.");
      }
      // Send to Netlify
      const r = await fetch(API_STAGE, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const j = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(j?.error || `Proxy error ${r.status}`);
      const imgs = j?.info?.images || [];
      if (!imgs.length) { setStatus("No images returned."); return; }
      setStatus("Done ✅");
      // Render results
      imgs.forEach(x => {
        const card = document.createElement("div");
        card.style.border = "1px solid #eee";
        card.style.borderRadius = "12px";
        card.style.overflow = "hidden";
        card.style.background = "#fff";
        const a = document.createElement("a");
        a.href = x.url; a.target = "_blank"; a.rel = "noopener";
        const im = document.createElement("img");
        im.src = x.url; im.alt = "Staged result"; im.style.width = "100%";
        a.appendChild(im);
        const meta = document.createElement("div");
        meta.style.padding = "8px 10px";
        meta.style.fontFamily = "system-ui";
        meta.textContent = `${x.width || ""}×${x.height || ""}`;
        card.appendChild(a);
        card.appendChild(meta);
        grid.appendChild(card);
      });
    } catch (err) {
      console.error(err);
      setStatus("Error: " + err.message);
    } finally {
      btn.disabled = false;
    }
  });
})();
</script>
</body>
</html>